// Test cognitive hive features

// ===== Test 1: Specialist definition =====
specialist Summarizer {
    model: "mistral-7b",
    temperature: 70,

    var summary_count: i64 = 0;

    receive Summarize(text: i64) -> i64 {
        self.summary_count = self.summary_count + 1;
        // In real use, this would call infer()
        text
    }

    receive GetCount() -> i64 {
        self.summary_count
    }
}

fn test_specialist_spawn() -> i64 {
    let s = spawn Summarizer {};
    1  // Just test spawn works
}

fn test_specialist_send() -> i64 {
    let s = spawn Summarizer {};
    send(s, Summarize(100));
    send(s, Summarize(200));
    1
}

fn test_specialist_ask() -> i64 {
    let s = spawn Summarizer {};
    send(s, Summarize(100));
    send(s, Summarize(200));
    send(s, Summarize(300));
    let count = ask(s, GetCount());
    count  // Should be 3
}

// ===== Test 2: Hive definition =====
specialist Analyzer {
    model: "llama-7b",

    var analyzed: i64 = 0;

    receive Analyze(data: i64) -> i64 {
        self.analyzed = self.analyzed + data;
        self.analyzed
    }
}

hive ProcessingHive {
    specialists: [Summarizer, Analyzer],
    router: SemanticRouter,
    strategy: OneForOne
}

fn test_hive_create() -> i64 {
    let h = ProcessingHive::new();
    1  // Test hive creation works
}

// ===== Test 3: Belief system =====
// believe(content, truth_category, confidence)
// truth_category: 0=false, 1=true, 2=uncertain
fn test_belief_create() -> i64 {
    // Create a belief with confidence 80%, category=true(1)
    let b1 = believe("The sky is blue", 1, 80);
    if b1 > 0 {
        1
    } else {
        0
    }
}

fn test_belief_query() -> i64 {
    let b1 = believe("Water is wet", 1, 90);
    let b2 = believe("Fire is hot", 1, 85);
    let b3 = believe("Ice is cold", 1, 75);

    // Query beliefs - count should include these
    let count = belief_count();
    if count >= 3 {
        1
    } else {
        0
    }
}

fn test_belief_confidence() -> i64 {
    let b1 = believe("Simplex is cool", 1, 95);
    let conf = belief_confidence(b1);
    if conf == 95 {
        1
    } else {
        0
    }
}

fn test_belief_update() -> i64 {
    let b1 = believe("Initial belief", 1, 50);
    update_belief(b1, 90);
    let new_conf = belief_confidence(b1);
    if new_conf == 90 {
        1
    } else {
        0
    }
}

fn test_belief_revoke() -> i64 {
    let initial_count = belief_count();
    let b1 = believe("Temporary belief", 1, 60);
    let after_add = belief_count();
    revoke_belief(b1);
    let after_revoke = belief_count();

    if after_add == initial_count + 1 && after_revoke == initial_count {
        1
    } else {
        0
    }
}

fn main() -> i64 {
    var passed = 0;
    var total = 9;

    print("=== Cognitive Hive Tests ===\n\n");

    // Specialist tests
    print("Testing specialist spawn...\n");
    if test_specialist_spawn() == 1 {
        print("specialist_spawn: PASS\n");
        passed = passed + 1;
    } else {
        print("specialist_spawn: FAIL\n");
    }

    print("\nTesting specialist send...\n");
    if test_specialist_send() == 1 {
        print("specialist_send: PASS\n");
        passed = passed + 1;
    } else {
        print("specialist_send: FAIL\n");
    }

    print("\nTesting specialist ask...\n");
    let ask_result = test_specialist_ask();
    print("Count: ");
    print_i64(ask_result);
    print("\n");
    if ask_result == 3 {
        print("specialist_ask: PASS\n");
        passed = passed + 1;
    } else {
        print("specialist_ask: FAIL\n");
    }

    // Hive tests
    print("\nTesting hive create...\n");
    if test_hive_create() == 1 {
        print("hive_create: PASS\n");
        passed = passed + 1;
    } else {
        print("hive_create: FAIL\n");
    }

    // Belief system tests
    print("\nTesting belief create...\n");
    if test_belief_create() == 1 {
        print("belief_create: PASS\n");
        passed = passed + 1;
    } else {
        print("belief_create: FAIL\n");
    }

    print("\nTesting belief query...\n");
    if test_belief_query() == 1 {
        print("belief_query: PASS\n");
        passed = passed + 1;
    } else {
        print("belief_query: FAIL\n");
    }

    print("\nTesting belief confidence...\n");
    if test_belief_confidence() == 1 {
        print("belief_confidence: PASS\n");
        passed = passed + 1;
    } else {
        print("belief_confidence: FAIL\n");
    }

    print("\nTesting belief update...\n");
    if test_belief_update() == 1 {
        print("belief_update: PASS\n");
        passed = passed + 1;
    } else {
        print("belief_update: FAIL\n");
    }

    print("\nTesting belief revoke...\n");
    if test_belief_revoke() == 1 {
        print("belief_revoke: PASS\n");
        passed = passed + 1;
    } else {
        print("belief_revoke: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(total);
    print("\n");

    passed
}
