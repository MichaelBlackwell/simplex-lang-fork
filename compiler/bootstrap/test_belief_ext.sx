// Test file for extended Belief System intrinsics

fn main() -> i64 {
    let passed = 0;
    let failed = 0;
    print("=== Belief System Extended Tests ===\n");

    // Test 1: Create a new belief store
    print("Test 1: belief_store_new()... ");
    let store1 = belief_store_new();
    if store1 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 2: Create another belief store
    print("Test 2: belief_store_new() second store... ");
    let store2 = belief_store_new();
    if store2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 3: Stores should be different handles
    print("Test 3: Different store handles... ");
    if store1 != store2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 4: Initial belief count should be 0
    print("Test 4: belief_store_count() initial... ");
    let count1 = belief_store_count(store1);
    if count1 == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 5: Add a belief with confidence 0.8
    print("Test 5: belief_add() first belief... ");
    let belief1 = belief_add(store1, "The sky is blue", 0.8);
    if belief1 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 6: Count should be 1 after adding
    print("Test 6: belief_store_count() after add... ");
    let count2 = belief_store_count(store1);
    if count2 == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 7: Add second belief
    print("Test 7: belief_add() second belief... ");
    let belief2 = belief_add(store1, "Water is wet", 0.9);
    if belief2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 8: Count should be 2
    print("Test 8: belief_store_count() is 2... ");
    let count3 = belief_store_count(store1);
    if count3 == 2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 9: belief_count alias
    print("Test 9: belief_count() alias... ");
    let count4 = belief_count(store1);
    if count4 == 2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 10: Add belief with low confidence
    print("Test 10: belief_add() low confidence 0.3... ");
    let belief3 = belief_add(store1, "Maybe it will rain", 0.3);
    if belief3 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 11: Add belief with high confidence
    print("Test 11: belief_add() high confidence 0.99... ");
    let belief4 = belief_add(store1, "Math is consistent", 0.99);
    if belief4 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 12: Count should be 4
    print("Test 12: belief_store_count() is 4... ");
    let count5 = belief_store_count(store1);
    if count5 == 4 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 13: Strategy confidence returns valid handle
    print("Test 13: belief_strategy_confidence()... ");
    let strat_conf = belief_strategy_confidence();
    if strat_conf >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 14: Strategy recency returns valid handle
    print("Test 14: belief_strategy_recency()... ");
    let strat_rec = belief_strategy_recency();
    if strat_rec >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 15: Strategy merge returns valid handle
    print("Test 15: belief_strategy_merge()... ");
    let strat_merge = belief_strategy_merge();
    if strat_merge >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 16: Different strategies have different handles
    print("Test 16: Different strategy handles... ");
    if strat_conf != strat_rec && strat_rec != strat_merge {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 17: Initial contradiction count
    print("Test 17: belief_contradiction_count() initial... ");
    let contra1 = belief_contradiction_count(store1);
    if contra1 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 18: Find contradictions returns valid result
    print("Test 18: belief_find_contradictions()... ");
    let contra_list = belief_find_contradictions(store1);
    if contra_list >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 19: Add potentially contradictory beliefs
    print("Test 19: belief_add() contradictory belief 1... ");
    let belief5 = belief_add(store1, "The door is open", 0.8);
    if belief5 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 20: Add opposite belief
    print("Test 20: belief_add() contradictory belief 2... ");
    let belief6 = belief_add(store1, "The door is closed", 0.7);
    if belief6 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 21: Check contradiction count after adding opposites
    print("Test 21: belief_contradiction_count() after opposites... ");
    let contra2 = belief_contradiction_count(store1);
    if contra2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 22: Second store should still be empty
    print("Test 22: Store2 still empty... ");
    let count_s2 = belief_store_count(store2);
    if count_s2 == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 23: Add belief to second store
    print("Test 23: belief_add() to store2... ");
    let belief7 = belief_add(store2, "Store2 belief", 0.5);
    if belief7 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 24: Close second store
    print("Test 24: belief_store_close() store2... ");
    belief_store_close(store2);
    print("PASSED\n");
    passed = passed + 1;

    // Test 25: Close first store
    print("Test 25: belief_store_close() store1... ");
    belief_store_close(store1);
    print("PASSED\n");
    passed = passed + 1;

    print("\n=== Results ===\n");
    print("Passed: "); print_i64(passed); print(" / "); print_i64(passed + failed); print("\n");
    return failed;
}
