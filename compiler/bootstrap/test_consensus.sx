// Test file for Consensus intrinsics

fn main() -> i64 {
    let passed = 0;
    let failed = 0;
    print("=== Consensus Tests ===\n");

    // Test 1: consensus_paxos returns a protocol constant
    print("Test 1: consensus_paxos() returns protocol constant... ");
    let paxos = consensus_paxos();
    if paxos >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 2: consensus_raft returns a protocol constant
    print("Test 2: consensus_raft() returns protocol constant... ");
    let raft = consensus_raft();
    if raft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 3: consensus_pbft returns a protocol constant
    print("Test 3: consensus_pbft() returns protocol constant... ");
    let pbft = consensus_pbft();
    if pbft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 4: Protocol constants are distinct
    print("Test 4: Protocol constants are distinct... ");
    if paxos != raft && raft != pbft && paxos != pbft {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 5: consensus_new with Paxos protocol
    print("Test 5: consensus_new(paxos) creates node... ");
    let node_paxos = consensus_new(paxos);
    if node_paxos >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 6: consensus_new with Raft protocol
    print("Test 6: consensus_new(raft) creates node... ");
    let node_raft = consensus_new(raft);
    if node_raft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 7: consensus_new with PBFT protocol
    print("Test 7: consensus_new(pbft) creates node... ");
    let node_pbft = consensus_new(pbft);
    if node_pbft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 8: consensus_term returns term for Paxos node
    print("Test 8: consensus_term(paxos_node) returns term... ");
    let term_paxos = consensus_term(node_paxos);
    if term_paxos >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 9: consensus_term returns term for Raft node
    print("Test 9: consensus_term(raft_node) returns term... ");
    let term_raft = consensus_term(node_raft);
    if term_raft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 10: consensus_get_state returns state for node
    print("Test 10: consensus_get_state(paxos_node) returns state... ");
    let state_paxos = consensus_get_state(node_paxos);
    if state_paxos >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 11: consensus_get_state for Raft node
    print("Test 11: consensus_get_state(raft_node) returns state... ");
    let state_raft = consensus_get_state(node_raft);
    if state_raft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 12: consensus_log_count returns count for node
    print("Test 12: consensus_log_count(paxos_node) returns count... ");
    let log_count = consensus_log_count(node_paxos);
    if log_count >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 13: consensus_log_count for Raft node
    print("Test 13: consensus_log_count(raft_node) returns count... ");
    let log_count_raft = consensus_log_count(node_raft);
    if log_count_raft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 14: consensus_status returns status for node
    print("Test 14: consensus_status(paxos_node) returns status... ");
    let status_paxos = consensus_status(node_paxos);
    if status_paxos >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 15: consensus_status for PBFT node
    print("Test 15: consensus_status(pbft_node) returns status... ");
    let status_pbft = consensus_status(node_pbft);
    if status_pbft >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 16: consensus_group_new creates a group
    print("Test 16: consensus_group_new creates group... ");
    let group1 = consensus_group_new("test_group", 3);
    if group1 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 17: consensus_group_new with different threshold
    print("Test 17: consensus_group_new with threshold 5... ");
    let group2 = consensus_group_new("quorum_group", 5);
    if group2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 18: Multiple groups can be created
    print("Test 18: Multiple groups have different handles... ");
    if group1 != group2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 19: consensus_group_close closes group without crash
    print("Test 19: consensus_group_close(group1) completes... ");
    consensus_group_close(group1);
    print("PASSED\n");
    passed = passed + 1;

    // Test 20: consensus_close closes nodes without crash
    print("Test 20: consensus_close(nodes) completes... ");
    consensus_close(node_paxos);
    consensus_close(node_raft);
    consensus_close(node_pbft);
    consensus_group_close(group2);
    print("PASSED\n");
    passed = passed + 1;

    print("\n");
    print("Passed: "); print_i64(passed); print(" / "); print_i64(passed + failed); print("\n");
    return failed;
}
