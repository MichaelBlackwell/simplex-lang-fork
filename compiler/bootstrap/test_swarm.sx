// Test Collective Intelligence - Swarm Communication

// Topic IDs for organizing messages
// Topics allow agents to subscribe to relevant information

// Test broadcasting a message to the swarm
fn test_swarm_broadcast() -> i64 {
    // swarm_broadcast(sender_id, topic, content) -> message_id
    let msg_id = swarm_broadcast(1, 100, "Hello swarm!");
    if msg_id > 0 {
        1
    } else {
        0
    }
}

// Test multiple broadcasts from different senders
fn test_multi_broadcast() -> i64 {
    let msg1 = swarm_broadcast(1, 200, "Agent 1 reporting");
    let msg2 = swarm_broadcast(2, 200, "Agent 2 reporting");
    let msg3 = swarm_broadcast(3, 200, "Agent 3 reporting");

    // All should get unique IDs
    if msg1 > 0 && msg2 > 0 && msg3 > 0 && msg1 != msg2 && msg2 != msg3 {
        1
    } else {
        0
    }
}

// Test broadcasting on different topics
fn test_topic_isolation() -> i64 {
    let topic_a = 300;
    let topic_b = 301;

    let msg_a1 = swarm_broadcast(1, topic_a, "Topic A message 1");
    let msg_a2 = swarm_broadcast(2, topic_a, "Topic A message 2");
    let msg_b1 = swarm_broadcast(3, topic_b, "Topic B message 1");

    // All messages should be created successfully
    if msg_a1 > 0 && msg_a2 > 0 && msg_b1 > 0 {
        1
    } else {
        0
    }
}

// Test receiving swarm messages
fn test_swarm_messages() -> i64 {
    let topic = 400;

    // Broadcast some messages
    swarm_broadcast(1, topic, "First message");
    swarm_broadcast(2, topic, "Second message");
    swarm_broadcast(3, topic, "Third message");

    // Get messages (since timestamp 0 = all messages)
    let messages = swarm_messages(topic, 0);

    // Messages should be a valid vector pointer
    if messages != 0 {
        1
    } else {
        0
    }
}

// Test swarm coordination pattern
fn test_swarm_coordination() -> i64 {
    let coord_topic = 500;

    // Leader broadcasts task
    let task_id = swarm_broadcast(0, coord_topic, "Task: process data");

    // Workers acknowledge
    let ack1 = swarm_broadcast(1, coord_topic, "Worker 1 ready");
    let ack2 = swarm_broadcast(2, coord_topic, "Worker 2 ready");
    let ack3 = swarm_broadcast(3, coord_topic, "Worker 3 ready");

    // Check all messages were sent
    if task_id > 0 && ack1 > 0 && ack2 > 0 && ack3 > 0 {
        1
    } else {
        0
    }
}

// Test voting pattern via swarm messages
fn test_swarm_voting() -> i64 {
    let vote_topic = 600;

    // Agents cast votes as messages
    swarm_broadcast(1, vote_topic, "vote:yes");
    swarm_broadcast(2, vote_topic, "vote:yes");
    swarm_broadcast(3, vote_topic, "vote:no");
    swarm_broadcast(4, vote_topic, "vote:yes");

    // Get all votes
    let votes = swarm_messages(vote_topic, 0);

    if votes != 0 {
        1
    } else {
        0
    }
}

fn main() -> i64 {
    var passed = 0;
    var total = 6;

    print("=== Collective Intelligence / Swarm Tests ===\n\n");

    print("Testing swarm broadcast...\n");
    if test_swarm_broadcast() == 1 {
        print("swarm_broadcast: PASS\n");
        passed = passed + 1;
    } else {
        print("swarm_broadcast: FAIL\n");
    }

    print("\nTesting multi broadcast...\n");
    if test_multi_broadcast() == 1 {
        print("multi_broadcast: PASS\n");
        passed = passed + 1;
    } else {
        print("multi_broadcast: FAIL\n");
    }

    print("\nTesting topic isolation...\n");
    if test_topic_isolation() == 1 {
        print("topic_isolation: PASS\n");
        passed = passed + 1;
    } else {
        print("topic_isolation: FAIL\n");
    }

    print("\nTesting swarm messages...\n");
    if test_swarm_messages() == 1 {
        print("swarm_messages: PASS\n");
        passed = passed + 1;
    } else {
        print("swarm_messages: FAIL\n");
    }

    print("\nTesting swarm coordination...\n");
    if test_swarm_coordination() == 1 {
        print("swarm_coordination: PASS\n");
        passed = passed + 1;
    } else {
        print("swarm_coordination: FAIL\n");
    }

    print("\nTesting swarm voting...\n");
    if test_swarm_voting() == 1 {
        print("swarm_voting: PASS\n");
        passed = passed + 1;
    } else {
        print("swarm_voting: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(total);
    print("\n");

    passed
}
