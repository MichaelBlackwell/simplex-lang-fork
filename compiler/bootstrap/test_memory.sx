// Test memory intrinsics: remember, recall, forget

// Test basic remember - stores a memory and returns its ID
fn test_remember_basic() -> i64 {
    // remember(content, importance, ttl_ms)
    // importance: 0-100, ttl_ms: time-to-live in milliseconds (0 = forever)
    let id = remember("First memory", 80, 0);
    if id > 0 {
        1
    } else {
        0
    }
}

// Test memory count
fn test_memory_count() -> i64 {
    let initial = memory_count();
    let id1 = remember("Memory A", 50, 0);
    let id2 = remember("Memory B", 60, 0);
    let after = memory_count();

    if after == initial + 2 {
        1
    } else {
        0
    }
}

// Test recall_one - retrieve a specific memory by ID
fn test_recall_one() -> i64 {
    let id = remember("Specific memory to recall", 90, 0);
    let result = recall_one(id);
    // recall_one returns a pointer to the memory content
    if result != 0 {
        1
    } else {
        0
    }
}

// Test forget - remove a memory
fn test_forget() -> i64 {
    let initial = memory_count();
    let id = remember("Memory to forget", 70, 0);
    let after_add = memory_count();
    forget(id);
    let after_forget = memory_count();

    if after_add == initial + 1 && after_forget == initial {
        1
    } else {
        0
    }
}

// Test memory importance
fn test_memory_importance() -> i64 {
    let id = remember("Important memory", 85, 0);
    let importance = memory_importance(id);
    if importance == 85 {
        1
    } else {
        0
    }
}

// Test set memory importance
fn test_set_importance() -> i64 {
    let id = remember("Memory with changing importance", 50, 0);
    memory_set_importance(id, 95);
    let new_importance = memory_importance(id);
    if new_importance == 95 {
        1
    } else {
        0
    }
}

// Test recall with query - finds memories matching query
fn test_recall_query() -> i64 {
    let id1 = remember("The sky is blue", 80, 0);
    let id2 = remember("Water is wet", 80, 0);
    let id3 = remember("The sky is vast", 80, 0);

    // recall(query, limit) returns matching memories
    let results = recall("sky", 10);
    // results is a vector pointer
    if results != 0 {
        1
    } else {
        0
    }
}

fn main() -> i64 {
    var passed = 0;
    var total = 7;

    print("=== Memory Intrinsics Tests ===\n\n");

    print("Testing remember basic...\n");
    if test_remember_basic() == 1 {
        print("remember_basic: PASS\n");
        passed = passed + 1;
    } else {
        print("remember_basic: FAIL\n");
    }

    print("\nTesting memory count...\n");
    if test_memory_count() == 1 {
        print("memory_count: PASS\n");
        passed = passed + 1;
    } else {
        print("memory_count: FAIL\n");
    }

    print("\nTesting recall_one...\n");
    if test_recall_one() == 1 {
        print("recall_one: PASS\n");
        passed = passed + 1;
    } else {
        print("recall_one: FAIL\n");
    }

    print("\nTesting forget...\n");
    if test_forget() == 1 {
        print("forget: PASS\n");
        passed = passed + 1;
    } else {
        print("forget: FAIL\n");
    }

    print("\nTesting memory importance...\n");
    if test_memory_importance() == 1 {
        print("memory_importance: PASS\n");
        passed = passed + 1;
    } else {
        print("memory_importance: FAIL\n");
    }

    print("\nTesting set importance...\n");
    if test_set_importance() == 1 {
        print("set_importance: PASS\n");
        passed = passed + 1;
    } else {
        print("set_importance: FAIL\n");
    }

    print("\nTesting recall query...\n");
    if test_recall_query() == 1 {
        print("recall_query: PASS\n");
        passed = passed + 1;
    } else {
        print("recall_query: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(total);
    print("\n");

    passed
}
