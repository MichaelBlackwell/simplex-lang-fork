// Test file for extended BDI Agent intrinsics

fn main() -> i64 {
    let passed = 0;
    let failed = 0;
    print("=== BDI Agent Tests ===\n");

    // Test 1: Create a new BDI agent
    print("Test 1: bdi_agent_new creates agent... ");
    let agent1 = bdi_agent_new();
    if agent1 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 2: Create a second agent (verify multiple agents work)
    print("Test 2: bdi_agent_new creates second agent... ");
    let agent2 = bdi_agent_new();
    if agent2 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 3: Agents should have different handles
    print("Test 3: Different agents have different handles... ");
    if agent1 != agent2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 4: New agent should have zero goals
    print("Test 4: New agent has zero goals... ");
    let goal_count = bdi_goal_count(agent1);
    if goal_count == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 5: New agent should have zero intentions
    print("Test 5: New agent has zero intentions... ");
    let intention_count = bdi_intention_count(agent1);
    if intention_count == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 6: Add a belief with high confidence
    print("Test 6: bdi_add_belief with confidence 0.9... ");
    let belief_result = bdi_add_belief(agent1, "weather_is_sunny", 0.9);
    if belief_result >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 7: Add another belief
    print("Test 7: bdi_add_belief second belief... ");
    let belief_result2 = bdi_add_belief(agent1, "have_umbrella", 1.0);
    if belief_result2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 8: Add a goal using description and priority
    print("Test 8: bdi_add_goal_desc with priority 1.0... ");
    let goal_desc_result = bdi_add_goal_desc(agent1, "stay_dry", 1.0);
    if goal_desc_result >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 9: Goal count should now be 1
    print("Test 9: Goal count is 1 after adding goal... ");
    let goal_count2 = bdi_goal_count(agent1);
    if goal_count2 == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED (got ");
        print_i64(goal_count2);
        print(")\n");
        failed = failed + 1;
    }

    // Test 10: Add another goal with different priority
    print("Test 10: bdi_add_goal_desc second goal... ");
    let goal_desc_result2 = bdi_add_goal_desc(agent1, "get_coffee", 0.5);
    if goal_desc_result2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 11: Goal count should now be 2
    print("Test 11: Goal count is 2 after adding second goal... ");
    let goal_count3 = bdi_goal_count(agent1);
    if goal_count3 == 2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED (got ");
        print_i64(goal_count3);
        print(")\n");
        failed = failed + 1;
    }

    // Test 12: Deliberate on agent
    print("Test 12: bdi_deliberate runs without error... ");
    let deliberate_result = bdi_deliberate(agent1);
    if deliberate_result >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 13: Execute on agent
    print("Test 13: bdi_execute runs without error... ");
    let execute_result = bdi_execute(agent1);
    if execute_result >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 14: Add goal using pointer (use 0 as null goal)
    print("Test 14: bdi_add_goal with goal pointer... ");
    let add_goal_result = bdi_add_goal(agent1, 0);
    // Even with null, should not crash - may return error code
    print("PASSED\n");
    passed = passed + 1;

    // Test 15: Second agent should still have zero goals
    print("Test 15: Second agent still has zero goals... ");
    let agent2_goals = bdi_goal_count(agent2);
    if agent2_goals == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 16: Add belief to second agent
    print("Test 16: Add belief to second agent... ");
    let belief_agent2 = bdi_add_belief(agent2, "test_belief", 0.75);
    if belief_agent2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 17: Deliberate on empty agent (agent2 has no goals)
    print("Test 17: bdi_deliberate on agent with no goals... ");
    let deliberate_empty = bdi_deliberate(agent2);
    if deliberate_empty >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 18: Execute on empty agent
    print("Test 18: bdi_execute on agent with no goals... ");
    let execute_empty = bdi_execute(agent2);
    if execute_empty >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 19: Close second agent
    print("Test 19: bdi_agent_close on second agent... ");
    bdi_agent_close(agent2);
    print("PASSED\n");
    passed = passed + 1;

    // Test 20: Close first agent
    print("Test 20: bdi_agent_close on first agent... ");
    bdi_agent_close(agent1);
    print("PASSED\n");
    passed = passed + 1;

    // Summary
    print("\n=== Test Summary ===\n");
    print("Passed: "); print_i64(passed); print(" / "); print_i64(passed + failed); print("\n");
    return failed;
}
