// Simple Feature Tests for Simplex Self-Hosted Compiler

fn test_basic_math() -> i64 {
    var a = 10;
    var b = 20;
    a + b * 2 - 5  // Should be 45
}

fn test_conditionals() -> i64 {
    var x = 15;
    if x > 10 {
        1
    } else {
        0
    }
}

fn test_while_loop() -> i64 {
    var count = 0;
    var i = 0;
    while i < 5 {
        count = count + i;
        i = i + 1;
    }
    count  // Should be 10 (0+1+2+3+4)
}

fn test_for_loop() -> i64 {
    var sum = 0;
    for i in 0..5 {
        sum = sum + i;
    }
    sum  // Should be 10
}

struct Point {
    x: i64,
    y: i64,
}

fn test_struct_creation() -> i64 {
    let p = Point { x: 10, y: 20 };
    p.x + p.y  // Should be 30
}

enum Status {
    Ok(i64),
    Error,
}

fn test_enum_creation() -> i64 {
    let s = Status::Ok(42);
    match s {
        Status::Ok(v) => v,
        Status::Error => 0,
    }
}

fn test_match_literals() -> i64 {
    var x = 2;
    match x {
        1 => 10,
        2 => 20,
        3 => 30,
        _ => 0,
    }
}

fn identity<T>(x: T) -> T {
    x
}

fn test_generic_fn() -> i64 {
    identity(42)
}

fn main() -> i64 {
    var passed = 0;

    if test_basic_math() == 45 {
        print("basic_math: PASS\n");
        passed = passed + 1;
    } else {
        print("basic_math: FAIL\n");
    }

    if test_conditionals() == 1 {
        print("conditionals: PASS\n");
        passed = passed + 1;
    } else {
        print("conditionals: FAIL\n");
    }

    if test_while_loop() == 10 {
        print("while_loop: PASS\n");
        passed = passed + 1;
    } else {
        print("while_loop: FAIL\n");
    }

    if test_for_loop() == 10 {
        print("for_loop: PASS\n");
        passed = passed + 1;
    } else {
        print("for_loop: FAIL\n");
    }

    if test_struct_creation() == 30 {
        print("struct: PASS\n");
        passed = passed + 1;
    } else {
        print("struct: FAIL\n");
    }

    if test_enum_creation() == 42 {
        print("enum: PASS\n");
        passed = passed + 1;
    } else {
        print("enum: FAIL\n");
    }

    if test_match_literals() == 20 {
        print("match: PASS\n");
        passed = passed + 1;
    } else {
        print("match: FAIL\n");
    }

    if test_generic_fn() == 42 {
        print("generic_fn: PASS\n");
        passed = passed + 1;
    } else {
        print("generic_fn: FAIL\n");
    }

    print("\n=== Test Summary ===\n");
    passed
}
