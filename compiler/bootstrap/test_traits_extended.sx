// Extended trait tests

// ===== Multiple methods in trait =====
trait Shape {
    fn area(&self) -> i64;
    fn perimeter(&self) -> i64;
}

struct Rectangle {
    width: i64,
    height: i64,
}

impl Shape for Rectangle {
    fn area(&self) -> i64 {
        self.width * self.height
    }

    fn perimeter(&self) -> i64 {
        2 * (self.width + self.height)
    }
}

fn test_multiple_trait_methods() -> i64 {
    let r = Rectangle { width: 5, height: 3 };
    r.area() + r.perimeter()  // 15 + 16 = 31
}

// ===== Impl without trait =====
struct Vec2 {
    x: i64,
    y: i64,
}

impl Vec2 {
    fn new(x: i64, y: i64) -> Vec2 {
        Vec2 { x: x, y: y }
    }

    fn dot(&self, other: Vec2) -> i64 {
        self.x * other.x + self.y * other.y
    }

    fn magnitude_squared(&self) -> i64 {
        self.x * self.x + self.y * self.y
    }
}

fn test_multiple_inherent_methods() -> i64 {
    let v1: Vec2 = Vec2::new(3, 4);
    let v2 = Vec2 { x: 1, y: 2 };
    v1.dot(v2) + v1.magnitude_squared()  // (3*1 + 4*2) + (9 + 16) = 11 + 25 = 36
}

// ===== Method taking &self and returning modified value =====
struct Counter2 {
    value: i64,
}

impl Counter2 {
    fn add(&self, n: i64) -> i64 {
        self.value + n
    }

    fn double(&self) -> i64 {
        self.value * 2
    }
}

fn test_chained_operations() -> i64 {
    let c = Counter2 { value: 10 };
    c.add(5) + c.double()  // 15 + 20 = 35
}

fn main() -> i64 {
    var passed = 0;

    if test_multiple_trait_methods() == 31 {
        print("multiple_trait_methods: PASS\n");
        passed = passed + 1;
    } else {
        print("multiple_trait_methods: FAIL (got ");
        print_i64(test_multiple_trait_methods());
        print(")\n");
    }

    if test_multiple_inherent_methods() == 36 {
        print("multiple_inherent_methods: PASS\n");
        passed = passed + 1;
    } else {
        print("multiple_inherent_methods: FAIL (got ");
        print_i64(test_multiple_inherent_methods());
        print(")\n");
    }

    if test_chained_operations() == 35 {
        print("chained_operations: PASS\n");
        passed = passed + 1;
    } else {
        print("chained_operations: FAIL (got ");
        print_i64(test_chained_operations());
        print(")\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / 3\n");

    passed
}
