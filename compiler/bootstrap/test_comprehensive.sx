// Comprehensive Feature Tests for Simplex Self-Hosted Compiler
// Tests the features documented as implemented

// ===== Basic Language Features =====

fn test_basic_math() -> i64 {
    var a = 10;
    var b = 20;
    a + b * 2 - 5  // Should be 45
}

fn test_conditionals() -> i64 {
    var x = 15;
    if x > 10 {
        1
    } else {
        0
    }
}

fn test_while_loop() -> i64 {
    var count = 0;
    var i = 0;
    while i < 5 {
        count = count + i;
        i = i + 1;
    }
    count  // Should be 10 (0+1+2+3+4)
}

fn test_for_loop() -> i64 {
    var sum = 0;
    for i in 0..5 {
        sum = sum + i;
    }
    sum  // Should be 10
}

// ===== Struct Features =====

struct Point {
    x: i64,
    y: i64,
}

fn test_struct_creation() -> i64 {
    let p = Point { x: 10, y: 20 };
    p.x + p.y  // Should be 30
}

// ===== Enum Features =====

enum Status {
    Ok(i64),
    Error,
}

fn test_enum_creation() -> i64 {
    let s = Status::Ok(42);
    match s {
        Status::Ok(v) => v,
        Status::Error => 0,
    }
}

// ===== Match Features =====

fn test_match_literals() -> i64 {
    var x = 2;
    match x {
        1 => 10,
        2 => 20,
        3 => 30,
        _ => 0,
    }
}

// ===== Closure Features =====

fn test_closure_simple() -> i64 {
    let add = |a: i64, b: i64| -> i64 { a + b };
    add(3, 4)  // Should be 7
}

fn test_closure_capture() -> i64 {
    var base = 100;
    let add_base = |x: i64| -> i64 { base + x };
    add_base(5)  // Should be 105
}

// ===== Generic Features =====

fn identity<T>(x: T) -> T {
    x
}

fn test_generic_fn() -> i64 {
    identity(42)
}

// ===== Trait Features =====

trait Addable {
    fn add_val(&self, other: i64) -> i64;
}

struct Number {
    value: i64,
}

impl Addable for Number {
    fn add_val(&self, other: i64) -> i64 {
        self.value + other
    }
}

fn test_trait_impl() -> i64 {
    let n = Number { value: 10 };
    n.add_val(5)  // Should be 15
}

// ===== Main Test Runner =====

fn main() -> i64 {
    var passed = 0;
    var failed = 0;

    // Test basic math
    if test_basic_math() == 45 {
        print("basic_math: PASS\n");
        passed = passed + 1;
    } else {
        print("basic_math: FAIL\n");
        failed = failed + 1;
    }

    // Test conditionals
    if test_conditionals() == 1 {
        print("conditionals: PASS\n");
        passed = passed + 1;
    } else {
        print("conditionals: FAIL\n");
        failed = failed + 1;
    }

    // Test while loop
    if test_while_loop() == 10 {
        print("while_loop: PASS\n");
        passed = passed + 1;
    } else {
        print("while_loop: FAIL\n");
        failed = failed + 1;
    }

    // Test for loop
    if test_for_loop() == 10 {
        print("for_loop: PASS\n");
        passed = passed + 1;
    } else {
        print("for_loop: FAIL\n");
        failed = failed + 1;
    }

    // Test struct
    if test_struct_creation() == 30 {
        print("struct: PASS\n");
        passed = passed + 1;
    } else {
        print("struct: FAIL\n");
        failed = failed + 1;
    }

    // Test enum
    if test_enum_creation() == 42 {
        print("enum: PASS\n");
        passed = passed + 1;
    } else {
        print("enum: FAIL\n");
        failed = failed + 1;
    }

    // Test match
    if test_match_literals() == 20 {
        print("match: PASS\n");
        passed = passed + 1;
    } else {
        print("match: FAIL\n");
        failed = failed + 1;
    }

    // Test closures
    if test_closure_simple() == 7 {
        print("closure_simple: PASS\n");
        passed = passed + 1;
    } else {
        print("closure_simple: FAIL\n");
        failed = failed + 1;
    }

    if test_closure_capture() == 105 {
        print("closure_capture: PASS\n");
        passed = passed + 1;
    } else {
        print("closure_capture: FAIL\n");
        failed = failed + 1;
    }

    // Test generics
    if test_generic_fn() == 42 {
        print("generic_fn: PASS\n");
        passed = passed + 1;
    } else {
        print("generic_fn: FAIL\n");
        failed = failed + 1;
    }

    // Test traits
    if test_trait_impl() == 15 {
        print("trait_impl: PASS\n");
        passed = passed + 1;
    } else {
        print("trait_impl: FAIL\n");
        failed = failed + 1;
    }

    print("\n=== Test Summary ===\n");
    // Return number of tests passed
    passed
}
