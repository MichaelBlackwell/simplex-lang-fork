// Test BDI (Belief-Desire-Intention) features
// Goals represent desires, intentions represent committed plans

// Goal status values:
// 0 = pending, 1 = active, 2 = achieved, 3 = failed

// Test adding a goal
fn test_add_goal() -> i64 {
    // add_goal(name, description, priority) -> goal_id
    let goal_id = add_goal("Learn Simplex", "Master the language", 80);
    if goal_id > 0 {
        1
    } else {
        0
    }
}

// Test goal status
fn test_goal_status() -> i64 {
    let goal_id = add_goal("Test Goal", "For testing", 50);
    let status = goal_status(goal_id);
    // New goals start as pending (status 0)
    if status == 0 {
        1
    } else {
        0
    }
}

// Test set goal status
fn test_set_goal_status() -> i64 {
    let goal_id = add_goal("Changeable Goal", "Status will change", 60);
    set_goal_status(goal_id, 2);  // Set to achieved
    let new_status = goal_status(goal_id);
    if new_status == 2 {
        1
    } else {
        0
    }
}

// Test select goal (picks highest priority pending goal)
fn test_select_goal() -> i64 {
    let g1 = add_goal("Low Priority", "Low", 30);
    let g2 = add_goal("High Priority", "High", 90);
    let g3 = add_goal("Medium Priority", "Medium", 60);

    let selected = select_goal();
    // Should select g2 (highest priority)
    if selected == g2 {
        1
    } else {
        0
    }
}

// Test pending goals count
fn test_pending_goals_count() -> i64 {
    let initial = pending_goals_count();
    let g1 = add_goal("Pending 1", "Will be pending", 50);
    let g2 = add_goal("Pending 2", "Will be pending", 50);
    let after = pending_goals_count();

    if after == initial + 2 {
        1
    } else {
        0
    }
}

// Test creating an intention
fn test_create_intention() -> i64 {
    let goal_id = add_goal("Intention Goal", "Goal for intention", 70);
    // create_intention(goal_id, plan_description, total_steps)
    let intention_id = create_intention(goal_id, "Step by step plan", 5);
    if intention_id > 0 {
        1
    } else {
        0
    }
}

// Test intention step (advances and returns current step)
fn test_intention_step() -> i64 {
    let goal_id = add_goal("Step Goal", "For step test", 70);
    let intention_id = create_intention(goal_id, "Multi-step plan", 3);

    let step1 = intention_step(intention_id);  // Advances to step 1
    let step2 = intention_step(intention_id);  // Advances to step 2

    if step1 == 1 && step2 == 2 {
        1
    } else {
        0
    }
}

// Test intention completion (stepping through all steps)
fn test_intention_completion() -> i64 {
    let goal_id = add_goal("Complete Goal", "Will be completed", 80);
    let intention_id = create_intention(goal_id, "Short plan", 2);

    intention_step(intention_id);  // Step 1
    intention_step(intention_id);  // Step 2 - completes

    // After completion, goal should be achieved (status 2)
    let goal_stat = goal_status(goal_id);
    if goal_stat == 2 {
        1
    } else {
        0
    }
}

// Test fail intention
fn test_fail_intention() -> i64 {
    let goal_id = add_goal("Fail Goal", "Will fail", 70);
    let intention_id = create_intention(goal_id, "Risky plan", 5);

    intention_step(intention_id);  // Start executing
    fail_intention(intention_id);  // Mark as failed

    // Goal should be back to pending (status 0)
    let goal_stat = goal_status(goal_id);
    if goal_stat == 0 {
        1
    } else {
        0
    }
}

fn main() -> i64 {
    var passed = 0;
    var total = 9;

    print("=== BDI (Goals & Intentions) Tests ===\n\n");

    print("Testing add goal...\n");
    if test_add_goal() == 1 {
        print("add_goal: PASS\n");
        passed = passed + 1;
    } else {
        print("add_goal: FAIL\n");
    }

    print("\nTesting goal status...\n");
    if test_goal_status() == 1 {
        print("goal_status: PASS\n");
        passed = passed + 1;
    } else {
        print("goal_status: FAIL\n");
    }

    print("\nTesting set goal status...\n");
    if test_set_goal_status() == 1 {
        print("set_goal_status: PASS\n");
        passed = passed + 1;
    } else {
        print("set_goal_status: FAIL\n");
    }

    print("\nTesting select goal...\n");
    if test_select_goal() == 1 {
        print("select_goal: PASS\n");
        passed = passed + 1;
    } else {
        print("select_goal: FAIL\n");
    }

    print("\nTesting pending goals count...\n");
    if test_pending_goals_count() == 1 {
        print("pending_goals_count: PASS\n");
        passed = passed + 1;
    } else {
        print("pending_goals_count: FAIL\n");
    }

    print("\nTesting create intention...\n");
    if test_create_intention() == 1 {
        print("create_intention: PASS\n");
        passed = passed + 1;
    } else {
        print("create_intention: FAIL\n");
    }

    print("\nTesting intention step...\n");
    if test_intention_step() == 1 {
        print("intention_step: PASS\n");
        passed = passed + 1;
    } else {
        print("intention_step: FAIL\n");
    }

    print("\nTesting intention completion...\n");
    if test_intention_completion() == 1 {
        print("intention_completion: PASS\n");
        passed = passed + 1;
    } else {
        print("intention_completion: FAIL\n");
    }

    print("\nTesting fail intention...\n");
    if test_fail_intention() == 1 {
        print("fail_intention: PASS\n");
        passed = passed + 1;
    } else {
        print("fail_intention: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(total);
    print("\n");

    passed
}
