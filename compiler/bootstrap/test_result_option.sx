// Test Result and Option Type Intrinsics
// Tests Option<T> and Result<T,E> operations

fn main() -> i64 {
    let passed = 0;
    let failed = 0;

    print("=== Result and Option Type Tests ===\n");

    // ==========================================
    // Option Type Tests
    // ==========================================
    print("\n--- Option Type ---\n");

    // Test 1: Create Some value
    let some_val = option_some(42);
    if some_val != 0 {
        print("Test 1 PASSED: option_some creates Option\n");
        passed = passed + 1;
    } else {
        print("Test 1 FAILED: option_some\n");
        failed = failed + 1;
    }

    // Test 2: Create None value
    let none_val = option_none();
    if none_val != 0 {
        print("Test 2 PASSED: option_none creates Option\n");
        passed = passed + 1;
    } else {
        print("Test 2 FAILED: option_none\n");
        failed = failed + 1;
    }

    // Test 3: Unwrap Some value
    let unwrapped = option_unwrap(some_val);
    if unwrapped == 42 {
        print("Test 3 PASSED: option_unwrap returns 42\n");
        passed = passed + 1;
    } else {
        print("Test 3 FAILED: option_unwrap\n");
        failed = failed + 1;
    }

    // Test 4: Get value from Some
    let some_val2 = option_some(100);
    let val = option_get_value(some_val2);
    if val == 100 {
        print("Test 4 PASSED: option_get_value returns 100\n");
        passed = passed + 1;
    } else {
        print("Test 4 FAILED: option_get_value\n");
        failed = failed + 1;
    }

    // Test 5: Unwrap or with Some
    let some_val3 = option_some(50);
    let or_val = option_unwrap_or(some_val3, 999);
    if or_val == 50 {
        print("Test 5 PASSED: option_unwrap_or returns Some value\n");
        passed = passed + 1;
    } else {
        print("Test 5 FAILED: option_unwrap_or with Some\n");
        failed = failed + 1;
    }

    // Test 6: Unwrap or with None
    let none_val2 = option_none();
    let or_val2 = option_unwrap_or(none_val2, 999);
    if or_val2 == 999 {
        print("Test 6 PASSED: option_unwrap_or returns default for None\n");
        passed = passed + 1;
    } else {
        print("Test 6 FAILED: option_unwrap_or with None\n");
        failed = failed + 1;
    }

    // Test 7: Option and with two Some values
    let opt_a = option_some(10);
    let opt_b = option_some(20);
    let and_result = option_and(opt_a, opt_b);
    if and_result != 0 {
        print("Test 7 PASSED: option_and with two Some\n");
        passed = passed + 1;
    } else {
        print("Test 7 FAILED: option_and\n");
        failed = failed + 1;
    }

    // Test 8: Option and with None
    let opt_c = option_none();
    let opt_d = option_some(30);
    let and_result2 = option_and(opt_c, opt_d);
    // and with None should return None-like result
    print("Test 8 PASSED: option_and with None runs\n");
    passed = passed + 1;

    // Test 9: Option or with Some and None
    let opt_e = option_some(40);
    let opt_f = option_none();
    let or_result = option_or(opt_e, opt_f);
    if or_result != 0 {
        print("Test 9 PASSED: option_or returns first Some\n");
        passed = passed + 1;
    } else {
        print("Test 9 FAILED: option_or\n");
        failed = failed + 1;
    }

    // Test 10: Option or with two None
    let opt_g = option_none();
    let opt_h = option_none();
    let or_result2 = option_or(opt_g, opt_h);
    print("Test 10 PASSED: option_or with two None runs\n");
    passed = passed + 1;

    // Test 11: Clone option
    let opt_orig = option_some(77);
    let opt_cloned = option_clone(opt_orig);
    if opt_cloned != 0 {
        print("Test 11 PASSED: option_clone works\n");
        passed = passed + 1;
    } else {
        print("Test 11 FAILED: option_clone\n");
        failed = failed + 1;
    }

    // Test 12: Option ok_or (convert Option to Result)
    let opt_i = option_some(88);
    let res_from_opt = option_ok_or(opt_i, 1);
    if res_from_opt != 0 {
        print("Test 12 PASSED: option_ok_or converts to Result\n");
        passed = passed + 1;
    } else {
        print("Test 12 FAILED: option_ok_or\n");
        failed = failed + 1;
    }

    // Test 13: Option flatten (requires Option<Option<T>>)
    // Create nested option: Some(Some(99))
    let inner_opt = option_some(99);
    let outer_opt = option_some(inner_opt);
    let flat = option_flatten(outer_opt);
    if flat != 0 {
        print("Test 13 PASSED: option_flatten works\n");
        passed = passed + 1;
    } else {
        print("Test 13 FAILED: option_flatten\n");
        failed = failed + 1;
    }

    // Test 14: Option transpose (requires Option<Result<T,E>>)
    // Create Option containing a Result: Some(Ok(111))
    let inner_res = result_ok(111);
    let opt_with_res = option_some(inner_res);
    let trans = option_transpose(opt_with_res);
    print("Test 14 PASSED: option_transpose runs\n");
    passed = passed + 1;

    // Test 15: Free option
    let opt_to_free = option_some(123);
    option_free(opt_to_free);
    print("Test 15 PASSED: option_free runs\n");
    passed = passed + 1;

    // ==========================================
    // Result Type Tests
    // ==========================================
    print("\n--- Result Type ---\n");

    // Test 16: Create Ok result
    let ok_res = result_ok(42);
    if ok_res != 0 {
        print("Test 16 PASSED: result_ok creates Result\n");
        passed = passed + 1;
    } else {
        print("Test 16 FAILED: result_ok\n");
        failed = failed + 1;
    }

    // Test 17: Create Err result
    let err_res = result_err(1);
    if err_res != 0 {
        print("Test 17 PASSED: result_err creates Result\n");
        passed = passed + 1;
    } else {
        print("Test 17 FAILED: result_err\n");
        failed = failed + 1;
    }

    // Test 18: Unwrap Ok result
    let ok_res2 = result_ok(100);
    let unwrapped_ok = result_unwrap(ok_res2);
    if unwrapped_ok == 100 {
        print("Test 18 PASSED: result_unwrap returns 100\n");
        passed = passed + 1;
    } else {
        print("Test 18 FAILED: result_unwrap\n");
        failed = failed + 1;
    }

    // Test 19: Get value from Ok
    let ok_res3 = result_ok(200);
    let ok_val = result_get_value(ok_res3);
    if ok_val == 200 {
        print("Test 19 PASSED: result_get_value returns 200\n");
        passed = passed + 1;
    } else {
        print("Test 19 FAILED: result_get_value\n");
        failed = failed + 1;
    }

    // Test 20: Get error from Err
    let err_res2 = result_err(55);
    let err_val = result_get_error(err_res2);
    if err_val == 55 {
        print("Test 20 PASSED: result_get_error returns 55\n");
        passed = passed + 1;
    } else {
        print("Test 20 FAILED: result_get_error\n");
        failed = failed + 1;
    }

    // Test 21: Unwrap or with Ok
    let ok_res4 = result_ok(300);
    let or_ok = result_unwrap_or(ok_res4, 999);
    if or_ok == 300 {
        print("Test 21 PASSED: result_unwrap_or returns Ok value\n");
        passed = passed + 1;
    } else {
        print("Test 21 FAILED: result_unwrap_or with Ok\n");
        failed = failed + 1;
    }

    // Test 22: Unwrap or with Err
    let err_res3 = result_err(2);
    let or_err = result_unwrap_or(err_res3, 999);
    if or_err == 999 {
        print("Test 22 PASSED: result_unwrap_or returns default for Err\n");
        passed = passed + 1;
    } else {
        print("Test 22 FAILED: result_unwrap_or with Err\n");
        failed = failed + 1;
    }

    // Test 23: Unwrap err
    let err_res4 = result_err(77);
    let unwrapped_err = result_unwrap_err(err_res4);
    if unwrapped_err == 77 {
        print("Test 23 PASSED: result_unwrap_err returns 77\n");
        passed = passed + 1;
    } else {
        print("Test 23 FAILED: result_unwrap_err\n");
        failed = failed + 1;
    }

    // Test 24: Result and with two Ok
    let res_a = result_ok(10);
    let res_b = result_ok(20);
    let and_res = result_and(res_a, res_b);
    if and_res != 0 {
        print("Test 24 PASSED: result_and with two Ok\n");
        passed = passed + 1;
    } else {
        print("Test 24 FAILED: result_and\n");
        failed = failed + 1;
    }

    // Test 25: Result and with Err
    let res_c = result_err(3);
    let res_d = result_ok(30);
    let and_res2 = result_and(res_c, res_d);
    print("Test 25 PASSED: result_and with Err runs\n");
    passed = passed + 1;

    // Test 26: Result or with Ok and Err
    let res_e = result_ok(40);
    let res_f = result_err(4);
    let or_res = result_or(res_e, res_f);
    if or_res != 0 {
        print("Test 26 PASSED: result_or returns first Ok\n");
        passed = passed + 1;
    } else {
        print("Test 26 FAILED: result_or\n");
        failed = failed + 1;
    }

    // Test 27: Result or with two Err
    let res_g = result_err(5);
    let res_h = result_err(6);
    let or_res2 = result_or(res_g, res_h);
    print("Test 27 PASSED: result_or with two Err runs\n");
    passed = passed + 1;

    // Test 28: Clone result
    let res_orig = result_ok(88);
    let res_cloned = result_clone(res_orig);
    if res_cloned != 0 {
        print("Test 28 PASSED: result_clone works\n");
        passed = passed + 1;
    } else {
        print("Test 28 FAILED: result_clone\n");
        failed = failed + 1;
    }

    // Test 29: Result ok_option (convert Ok to Some)
    let res_i = result_ok(99);
    let opt_from_ok = result_ok_option(res_i);
    if opt_from_ok != 0 {
        print("Test 29 PASSED: result_ok_option returns Option\n");
        passed = passed + 1;
    } else {
        print("Test 29 FAILED: result_ok_option\n");
        failed = failed + 1;
    }

    // Test 30: Result err_option (convert Err to Some)
    let res_j = result_err(7);
    let opt_from_err = result_err_option(res_j);
    if opt_from_err != 0 {
        print("Test 30 PASSED: result_err_option returns Option\n");
        passed = passed + 1;
    } else {
        print("Test 30 FAILED: result_err_option\n");
        failed = failed + 1;
    }

    // Test 31: Result flatten (requires Result<Result<T,E>,E>)
    // Create nested result: Ok(Ok(111))
    let inner_res_k = result_ok(111);
    let outer_res_k = result_ok(inner_res_k);
    let flat_res = result_flatten(outer_res_k);
    if flat_res != 0 {
        print("Test 31 PASSED: result_flatten works\n");
        passed = passed + 1;
    } else {
        print("Test 31 FAILED: result_flatten\n");
        failed = failed + 1;
    }

    // Test 32: Result transpose (requires Result<Option<T>,E>)
    // Create Result containing an Option: Ok(Some(222))
    let inner_opt_l = option_some(222);
    let res_with_opt = result_ok(inner_opt_l);
    let trans_res = result_transpose(res_with_opt);
    print("Test 32 PASSED: result_transpose runs\n");
    passed = passed + 1;

    // Test 33: Free result
    let res_to_free = result_ok(333);
    result_free(res_to_free);
    print("Test 33 PASSED: result_free runs\n");
    passed = passed + 1;

    // Test 34: Create result with error message
    let msg = "error message";
    let err_with_msg = result_err_msg(msg);
    if err_with_msg != 0 {
        print("Test 34 PASSED: result_err_msg creates Result\n");
        passed = passed + 1;
    } else {
        print("Test 34 FAILED: result_err_msg\n");
        failed = failed + 1;
    }

    // Test 35: Expect with Ok (should return value)
    let ok_expect = result_ok(444);
    let expect_msg = "should not panic";
    let expect_val = result_expect(ok_expect, expect_msg);
    if expect_val == 444 {
        print("Test 35 PASSED: result_expect returns value\n");
        passed = passed + 1;
    } else {
        print("Test 35 FAILED: result_expect\n");
        failed = failed + 1;
    }

    // ==========================================
    // Summary
    // ==========================================
    print("\n=== Result/Option Test Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(passed + failed);
    print("\n");

    if failed == 0 {
        print("All tests passed!\n");
    } else {
        print("Some tests failed.\n");
    }

    return failed;
}
