// Test async/await features

async fn simple_async() -> i64 {
    42
}

async fn async_with_await() -> i64 {
    let x = simple_async().await;
    x + 10
}

async fn async_sequence() -> i64 {
    let a = simple_async().await;
    let b = simple_async().await;
    a + b
}

fn test_simple_async() -> i64 {
    // Run async function synchronously for testing
    let result = simple_async().await;
    result
}

fn test_async_with_await() -> i64 {
    let result = async_with_await().await;
    result  // Should be 52
}

fn test_async_sequence() -> i64 {
    let result = async_sequence().await;
    result  // Should be 84
}

fn main() -> i64 {
    var passed = 0;

    print("Testing simple async...\n");
    let r1 = test_simple_async();
    print("Result: ");
    print_i64(r1);
    print("\n");
    if r1 == 42 {
        print("simple_async: PASS\n");
        passed = passed + 1;
    } else {
        print("simple_async: FAIL\n");
    }

    print("\nTesting async with await...\n");
    let r2 = test_async_with_await();
    print("Result: ");
    print_i64(r2);
    print("\n");
    if r2 == 52 {
        print("async_with_await: PASS\n");
        passed = passed + 1;
    } else {
        print("async_with_await: FAIL\n");
    }

    print("\nTesting async sequence...\n");
    let r3 = test_async_sequence();
    print("Result: ");
    print_i64(r3);
    print("\n");
    if r3 == 84 {
        print("async_sequence: PASS\n");
        passed = passed + 1;
    } else {
        print("async_sequence: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / 3\n");

    passed
}
