// Test file for Anima Memory intrinsics
// Tests the cognitive memory system functions

fn main() -> i64 {
    let passed = 0;
    let failed = 0;
    print("=== Anima Memory Tests ===\n");

    // Test 1: Create new anima memory
    print("Test 1: anima_memory_new... ");
    let mem = anima_memory_new(10);
    if mem != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 2: Initial episodic count should be 0
    print("Test 2: anima_episodic_count initial... ");
    let ep_count = anima_episodic_count(mem);
    if ep_count == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 3: Initial semantic count should be 0
    print("Test 3: anima_semantic_count initial... ");
    let sem_count = anima_semantic_count(mem);
    if sem_count == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 4: Initial beliefs count should be 0
    print("Test 4: anima_beliefs_count initial... ");
    let beliefs = anima_beliefs_count(mem);
    if beliefs == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 5: Initial working count should be 0
    print("Test 5: anima_working_count initial... ");
    let working = anima_working_count(mem);
    if working == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 6: Remember an item (returns memory ID > 0 on success)
    print("Test 6: anima_remember... ");
    let remember_result = anima_remember(mem, "first memory", 0.7);
    if remember_result > 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 7: Episodic count after remember should be 1
    print("Test 7: anima_episodic_count after remember... ");
    let ep_count2 = anima_episodic_count(mem);
    if ep_count2 == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 8: Remember another item (returns memory ID > 0 on success)
    print("Test 8: anima_remember second item... ");
    let remember_result2 = anima_remember(mem, "second memory", 0.8);
    if remember_result2 > 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 9: Episodic count should now be 2
    print("Test 9: anima_episodic_count is 2... ");
    let ep_count3 = anima_episodic_count(mem);
    if ep_count3 == 2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 10: Working memory push (returns 0 on success, 1 if full)
    print("Test 10: anima_working_push... ");
    let push_result = anima_working_push(mem, "working item 1");
    if push_result >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 11: Working count after push should be 1
    print("Test 11: anima_working_count after push... ");
    let working2 = anima_working_count(mem);
    if working2 == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 12: Push another working item (returns 0 on success, 1 if full)
    print("Test 12: anima_working_push second item... ");
    let push_result2 = anima_working_push(mem, "working item 2");
    if push_result2 >= 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 13: Working count should be 2
    print("Test 13: anima_working_count is 2... ");
    let working3 = anima_working_count(mem);
    if working3 == 2 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 14: Working memory pop
    print("Test 14: anima_working_pop... ");
    let pop_result = anima_working_pop(mem);
    if pop_result != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 15: Working count after pop should be 1
    print("Test 15: anima_working_count after pop... ");
    let working4 = anima_working_count(mem);
    if working4 == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 16: Consolidate memory
    print("Test 16: anima_consolidate... ");
    let consolidate_result = anima_consolidate(mem);
    if consolidate_result == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 17: Remember with low importance (returns memory ID > 0)
    print("Test 17: anima_remember low importance... ");
    let remember_low = anima_remember(mem, "low importance memory", 0.3);
    if remember_low > 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 18: Remember with high importance (returns memory ID > 0)
    print("Test 18: anima_remember high importance... ");
    let remember_high = anima_remember(mem, "high importance memory", 0.95);
    if remember_high > 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 19: Close memory (should not crash)
    print("Test 19: anima_memory_close... ");
    anima_memory_close(mem);
    print("PASSED\n");
    passed = passed + 1;

    // Test 20: Create new BDI agent
    print("Test 20: anima_bdi_new... ");
    let bdi = anima_bdi_new();
    if bdi != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 21: Initial desires count should be 0
    print("Test 21: anima_desires_count initial... ");
    let desires = anima_desires_count(bdi);
    if desires == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 22: Initial intentions count should be 0
    print("Test 22: anima_intentions_count initial... ");
    let intentions = anima_intentions_count(bdi);
    if intentions == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 23: Close BDI (should not crash)
    print("Test 23: anima_bdi_close... ");
    anima_bdi_close(bdi);
    print("PASSED\n");
    passed = passed + 1;

    // Test 24: Create another memory with different capacity
    print("Test 24: anima_memory_new with capacity 5... ");
    let mem2 = anima_memory_new(5);
    if mem2 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 25: Multiple operations on new memory
    print("Test 25: multiple operations on new memory... ");
    anima_working_push(mem2, "item a");
    anima_working_push(mem2, "item b");
    anima_remember(mem2, "test memory", 0.5);
    let final_working = anima_working_count(mem2);
    let final_episodic = anima_episodic_count(mem2);
    if final_working == 2 && final_episodic == 1 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Cleanup
    anima_memory_close(mem2);

    // Summary
    print("\n=== Test Summary ===\n");
    print("Passed: "); print_i64(passed); print(" / "); print_i64(passed + failed); print("\n");
    return failed;
}
