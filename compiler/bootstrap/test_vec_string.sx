// Test Vectors and String Operations

// ============ VECTOR TESTS ============

// Test creating a new vector
fn test_vec_new() -> i64 {
    let v = vec_new();
    if v != 0 {
        1
    } else {
        0
    }
}

// Test vector push and len
fn test_vec_push_len() -> i64 {
    let v = vec_new();
    vec_push(v, 10);
    vec_push(v, 20);
    vec_push(v, 30);
    let len = vec_len(v);
    if len == 3 {
        1
    } else {
        0
    }
}

// Test vector get
fn test_vec_get() -> i64 {
    let v = vec_new();
    vec_push(v, 100);
    vec_push(v, 200);
    vec_push(v, 300);
    let first = vec_get(v, 0);
    let second = vec_get(v, 1);
    let third = vec_get(v, 2);
    if first == 100 && second == 200 && third == 300 {
        1
    } else {
        0
    }
}

// Test vector set
fn test_vec_set() -> i64 {
    let v = vec_new();
    vec_push(v, 1);
    vec_push(v, 2);
    vec_push(v, 3);
    vec_set(v, 1, 99);
    let val = vec_get(v, 1);
    if val == 99 {
        1
    } else {
        0
    }
}

// Test vector pop
fn test_vec_pop() -> i64 {
    let v = vec_new();
    vec_push(v, 10);
    vec_push(v, 20);
    vec_push(v, 30);
    let popped = vec_pop(v);
    let new_len = vec_len(v);
    if popped == 30 && new_len == 2 {
        1
    } else {
        0
    }
}

// Test vector clear
fn test_vec_clear() -> i64 {
    let v = vec_new();
    vec_push(v, 1);
    vec_push(v, 2);
    vec_push(v, 3);
    vec_clear(v);
    let len = vec_len(v);
    if len == 0 {
        1
    } else {
        0
    }
}

// Test vector with loop
fn test_vec_loop() -> i64 {
    let v = vec_new();
    for i in 0..5 {
        vec_push(v, i * 10);
    }
    var sum = 0;
    for i in 0..5 {
        let val = vec_get(v, i);
        sum = sum + val;
    }
    // 0 + 10 + 20 + 30 + 40 = 100
    if sum == 100 {
        1
    } else {
        0
    }
}

// ============ STRING TESTS ============

// Test string length
fn test_string_len() -> i64 {
    let s = "Hello";
    let len = string_len(s);
    if len == 5 {
        1
    } else {
        0
    }
}

// Test string concatenation
fn test_string_concat() -> i64 {
    let a = "Hello";
    let b = " World";
    let c = string_concat(a, b);
    let len = string_len(c);
    // "Hello World" = 11 chars
    if len == 11 {
        1
    } else {
        0
    }
}

// Test string char_at
fn test_string_char_at() -> i64 {
    let s = "ABCDE";
    let c0 = string_char_at(s, 0);  // 'A' = 65
    let c2 = string_char_at(s, 2);  // 'C' = 67
    let c4 = string_char_at(s, 4);  // 'E' = 69
    if c0 == 65 && c2 == 67 && c4 == 69 {
        1
    } else {
        0
    }
}

// Test string slice
fn test_string_slice() -> i64 {
    let s = "Hello World";
    let sub = string_slice(s, 0, 5);
    let len = string_len(sub);
    // "Hello" = 5 chars
    if len == 5 {
        1
    } else {
        0
    }
}

// Test string equality
fn test_string_eq() -> i64 {
    let a = "test";
    let b = "test";
    let c = "other";
    let eq1 = string_eq(a, b);
    let eq2 = string_eq(a, c);
    if eq1 == 1 && eq2 == 0 {
        1
    } else {
        0
    }
}

// Test string from char
fn test_string_from_char() -> i64 {
    let s = string_from_char(65);  // 'A'
    let len = string_len(s);
    let ch = string_char_at(s, 0);
    if len == 1 && ch == 65 {
        1
    } else {
        0
    }
}

// Test string to int
fn test_string_to_int() -> i64 {
    let s = "12345";
    let n = string_to_int(s);
    if n == 12345 {
        1
    } else {
        0
    }
}

// Test int to string
fn test_int_to_string() -> i64 {
    let n = 42;
    let s = int_to_string(n);
    let len = string_len(s);
    // "42" = 2 chars
    if len == 2 {
        1
    } else {
        0
    }
}

// Test string contains
fn test_string_contains() -> i64 {
    let s = "Hello World";
    let has_world = string_contains(s, "World");
    let has_foo = string_contains(s, "foo");
    if has_world == 1 && has_foo == 0 {
        1
    } else {
        0
    }
}

// Test string starts_with
fn test_string_starts_with() -> i64 {
    let s = "Hello World";
    let starts_hello = string_starts_with(s, "Hello");
    let starts_world = string_starts_with(s, "World");
    if starts_hello == 1 && starts_world == 0 {
        1
    } else {
        0
    }
}

// Test string ends_with
fn test_string_ends_with() -> i64 {
    let s = "Hello World";
    let ends_world = string_ends_with(s, "World");
    let ends_hello = string_ends_with(s, "Hello");
    if ends_world == 1 && ends_hello == 0 {
        1
    } else {
        0
    }
}

// Test string find
fn test_string_find() -> i64 {
    let s = "Hello World";
    let pos_world = string_find(s, "World", 0);
    let pos_none = string_find(s, "xyz", 0);
    // "World" starts at index 6
    if pos_world == 6 && pos_none == -1 {
        1
    } else {
        0
    }
}

// Test string trim
fn test_string_trim() -> i64 {
    let s = "  hello  ";
    let trimmed = string_trim(s);
    let len = string_len(trimmed);
    // "hello" = 5 chars
    if len == 5 {
        1
    } else {
        0
    }
}

// Test building string in loop
fn test_string_build() -> i64 {
    var result = "";
    for i in 0..3 {
        result = string_concat(result, "a");
    }
    let len = string_len(result);
    // "aaa" = 3 chars
    if len == 3 {
        1
    } else {
        0
    }
}

fn main() -> i64 {
    var passed = 0;
    var total = 21;

    print("=== Vector and String Tests ===\n\n");

    // Vector tests
    print("Testing vec_new...\n");
    if test_vec_new() == 1 {
        print("vec_new: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_new: FAIL\n");
    }

    print("\nTesting vec_push_len...\n");
    if test_vec_push_len() == 1 {
        print("vec_push_len: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_push_len: FAIL\n");
    }

    print("\nTesting vec_get...\n");
    if test_vec_get() == 1 {
        print("vec_get: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_get: FAIL\n");
    }

    print("\nTesting vec_set...\n");
    if test_vec_set() == 1 {
        print("vec_set: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_set: FAIL\n");
    }

    print("\nTesting vec_pop...\n");
    if test_vec_pop() == 1 {
        print("vec_pop: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_pop: FAIL\n");
    }

    print("\nTesting vec_clear...\n");
    if test_vec_clear() == 1 {
        print("vec_clear: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_clear: FAIL\n");
    }

    print("\nTesting vec_loop...\n");
    if test_vec_loop() == 1 {
        print("vec_loop: PASS\n");
        passed = passed + 1;
    } else {
        print("vec_loop: FAIL\n");
    }

    // String tests
    print("\nTesting string_len...\n");
    if test_string_len() == 1 {
        print("string_len: PASS\n");
        passed = passed + 1;
    } else {
        print("string_len: FAIL\n");
    }

    print("\nTesting string_concat...\n");
    if test_string_concat() == 1 {
        print("string_concat: PASS\n");
        passed = passed + 1;
    } else {
        print("string_concat: FAIL\n");
    }

    print("\nTesting string_char_at...\n");
    if test_string_char_at() == 1 {
        print("string_char_at: PASS\n");
        passed = passed + 1;
    } else {
        print("string_char_at: FAIL\n");
    }

    print("\nTesting string_slice...\n");
    if test_string_slice() == 1 {
        print("string_slice: PASS\n");
        passed = passed + 1;
    } else {
        print("string_slice: FAIL\n");
    }

    print("\nTesting string_eq...\n");
    if test_string_eq() == 1 {
        print("string_eq: PASS\n");
        passed = passed + 1;
    } else {
        print("string_eq: FAIL\n");
    }

    print("\nTesting string_from_char...\n");
    if test_string_from_char() == 1 {
        print("string_from_char: PASS\n");
        passed = passed + 1;
    } else {
        print("string_from_char: FAIL\n");
    }

    print("\nTesting string_to_int...\n");
    if test_string_to_int() == 1 {
        print("string_to_int: PASS\n");
        passed = passed + 1;
    } else {
        print("string_to_int: FAIL\n");
    }

    print("\nTesting int_to_string...\n");
    if test_int_to_string() == 1 {
        print("int_to_string: PASS\n");
        passed = passed + 1;
    } else {
        print("int_to_string: FAIL\n");
    }

    print("\nTesting string_contains...\n");
    if test_string_contains() == 1 {
        print("string_contains: PASS\n");
        passed = passed + 1;
    } else {
        print("string_contains: FAIL\n");
    }

    print("\nTesting string_starts_with...\n");
    if test_string_starts_with() == 1 {
        print("string_starts_with: PASS\n");
        passed = passed + 1;
    } else {
        print("string_starts_with: FAIL\n");
    }

    print("\nTesting string_ends_with...\n");
    if test_string_ends_with() == 1 {
        print("string_ends_with: PASS\n");
        passed = passed + 1;
    } else {
        print("string_ends_with: FAIL\n");
    }

    print("\nTesting string_find...\n");
    if test_string_find() == 1 {
        print("string_find: PASS\n");
        passed = passed + 1;
    } else {
        print("string_find: FAIL\n");
    }

    print("\nTesting string_trim...\n");
    if test_string_trim() == 1 {
        print("string_trim: PASS\n");
        passed = passed + 1;
    } else {
        print("string_trim: FAIL\n");
    }

    print("\nTesting string_build...\n");
    if test_string_build() == 1 {
        print("string_build: PASS\n");
        passed = passed + 1;
    } else {
        print("string_build: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / ");
    print_i64(total);
    print("\n");

    passed
}
