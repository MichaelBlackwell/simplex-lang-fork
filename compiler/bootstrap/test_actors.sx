// Test actor model features

actor Counter {
    var count: i64 = 0;

    receive Increment() {
        self.count = self.count + 1;
    }

    receive Add(n: i64) {
        self.count = self.count + n;
    }

    receive Get() -> i64 {
        self.count
    }
}

fn test_actor_spawn() -> i64 {
    let counter = spawn Counter {};
    1  // Just test that spawn works
}

fn test_actor_send() -> i64 {
    let counter = spawn Counter {};
    send(counter, Increment());
    send(counter, Increment());
    send(counter, Increment());
    1  // Test that send works
}

fn test_actor_ask() -> i64 {
    let counter = spawn Counter {};
    send(counter, Add(10));
    send(counter, Add(5));
    let result = ask(counter, Get());
    result  // Should be 15
}

fn main() -> i64 {
    var passed = 0;

    print("Testing actor spawn...\n");
    let r1 = test_actor_spawn();
    if r1 == 1 {
        print("actor_spawn: PASS\n");
        passed = passed + 1;
    } else {
        print("actor_spawn: FAIL\n");
    }

    print("\nTesting actor send...\n");
    let r2 = test_actor_send();
    if r2 == 1 {
        print("actor_send: PASS\n");
        passed = passed + 1;
    } else {
        print("actor_send: FAIL\n");
    }

    print("\nTesting actor ask...\n");
    let r3 = test_actor_ask();
    print("Result: ");
    print_i64(r3);
    print("\n");
    if r3 == 15 {
        print("actor_ask: PASS\n");
        passed = passed + 1;
    } else {
        print("actor_ask: FAIL\n");
    }

    print("\n=== Summary ===\n");
    print("Passed: ");
    print_i64(passed);
    print(" / 3\n");

    passed
}
