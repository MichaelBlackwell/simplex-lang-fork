// HashSet Intrinsics Test Suite

fn main() -> i64 {
    let passed = 0;
    let failed = 0;
    print("=== HashSet Tests ===\n");

    // Test 1: hashset_new creates a set
    print("Test 1: hashset_new... ");
    let set1 = hashset_new();
    if set1 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 2: hashset_len on empty set returns 0
    print("Test 2: hashset_len on empty set... ");
    let len1 = hashset_len(set1);
    if len1 == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 3: hashset_with_capacity creates a set
    print("Test 3: hashset_with_capacity... ");
    let set2 = hashset_with_capacity(16);
    if set2 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 4: hashset_len on capacity-allocated set returns 0
    print("Test 4: hashset_len on capacity set... ");
    let len2 = hashset_len(set2);
    if len2 == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 5: hashset_clear on empty set doesn't crash
    print("Test 5: hashset_clear on empty set... ");
    hashset_clear(set1);
    let len_after_clear = hashset_len(set1);
    if len_after_clear == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 6: hashset_iter creates an iterator
    print("Test 6: hashset_iter... ");
    let iter1 = hashset_iter(set1);
    if iter1 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 7: hashset_iter_next on empty set returns 0 (null)
    print("Test 7: hashset_iter_next on empty set... ");
    let next_val = hashset_iter_next(iter1);
    if next_val == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 8: hashset_iter_free doesn't crash
    print("Test 8: hashset_iter_free... ");
    hashset_iter_free(iter1);
    print("PASSED\n");
    passed = passed + 1;

    // Test 9: hashset_union on empty sets
    print("Test 9: hashset_union on empty sets... ");
    let union_set = hashset_union(set1, set2);
    if union_set != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 10: hashset_union result has length 0
    print("Test 10: hashset_union result length... ");
    let union_len = hashset_len(union_set);
    if union_len == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 11: hashset_intersection on empty sets
    print("Test 11: hashset_intersection on empty sets... ");
    let inter_set = hashset_intersection(set1, set2);
    if inter_set != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 12: hashset_intersection result has length 0
    print("Test 12: hashset_intersection result length... ");
    let inter_len = hashset_len(inter_set);
    if inter_len == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 13: hashset_difference on empty sets
    print("Test 13: hashset_difference on empty sets... ");
    let diff_set = hashset_difference(set1, set2);
    if diff_set != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 14: hashset_difference result has length 0
    print("Test 14: hashset_difference result length... ");
    let diff_len = hashset_len(diff_set);
    if diff_len == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 15: hashset_symmetric_difference on empty sets
    print("Test 15: hashset_symmetric_difference on empty sets... ");
    let sym_diff_set = hashset_symmetric_difference(set1, set2);
    if sym_diff_set != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 16: hashset_symmetric_difference result has length 0
    print("Test 16: hashset_symmetric_difference result length... ");
    let sym_diff_len = hashset_len(sym_diff_set);
    if sym_diff_len == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 17: int_hashset_new creates a set
    print("Test 17: int_hashset_new... ");
    let int_set1 = int_hashset_new();
    if int_set1 != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 18: int_hashset_len on empty set returns 0
    print("Test 18: int_hashset_len on empty set... ");
    let int_len1 = int_hashset_len(int_set1);
    if int_len1 == 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 19: int_hashset_union on empty sets
    print("Test 19: int_hashset_union on empty sets... ");
    let int_set2 = int_hashset_new();
    let int_union = int_hashset_union(int_set1, int_set2);
    if int_union != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Test 20: int_hashset_intersection on empty sets
    print("Test 20: int_hashset_intersection on empty sets... ");
    let int_inter = int_hashset_intersection(int_set1, int_set2);
    if int_inter != 0 {
        print("PASSED\n");
        passed = passed + 1;
    } else {
        print("FAILED\n");
        failed = failed + 1;
    }

    // Clean up - free all allocated sets
    print("\nCleaning up...\n");
    hashset_free(set1);
    hashset_free(set2);
    hashset_free(union_set);
    hashset_free(inter_set);
    hashset_free(diff_set);
    hashset_free(sym_diff_set);

    // Print summary
    print("\n=== Summary ===\n");
    print("Passed: "); print_i64(passed); print(" / "); print_i64(passed + failed); print("\n");

    return failed;
}
