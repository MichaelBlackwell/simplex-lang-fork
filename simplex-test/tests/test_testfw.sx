// Test file for Test Framework Library
// Tests: tfw_assert, tfw_assert_eq_i64, tfw_assert_eq_str, etc.

fn test_reset_and_counters() -> i64 {
    // Reset counters
    tfw_reset()

    let passed: i64 = tfw_passed_count()
    let failed: i64 = tfw_failed_count()

    if passed != 0 {
        println("FAIL: passed count should be 0 after reset")
        return 1
    }

    if failed != 0 {
        println("FAIL: failed count should be 0 after reset")
        return 1
    }

    println("PASS: test_reset_and_counters")
    0
}

fn test_tfw_assert_true() -> i64 {
    tfw_reset()

    // This should pass
    tfw_assert(1, "should pass")

    let passed: i64 = tfw_passed_count()
    if passed != 1 {
        println("FAIL: passed count should be 1")
        return 1
    }

    println("PASS: test_assert_true")
    0
}

fn test_tfw_assert_false() -> i64 {
    tfw_reset()

    // This should fail (but we're testing the framework)
    tfw_assert(0, "expected to fail")

    let failed: i64 = tfw_failed_count()
    if failed != 1 {
        println("FAIL: failed count should be 1")
        return 1
    }

    println("PASS: test_assert_false")
    0
}

fn test_assert_eq_integers() -> i64 {
    tfw_reset()

    // Equal integers - should pass
    tfw_assert_eq_i64(42, 42, "42 == 42")

    let passed: i64 = tfw_passed_count()
    if passed != 1 {
        println("FAIL: passed count should be 1")
        return 1
    }

    // Not equal - should fail
    tfw_assert_eq_i64(1, 2, "1 != 2")

    let failed: i64 = tfw_failed_count()
    if failed != 1 {
        println("FAIL: failed count should be 1")
        return 1
    }

    println("PASS: test_assert_eq_integers")
    0
}

fn test_assert_eq_strings() -> i64 {
    tfw_reset()

    // Equal strings - should pass
    tfw_assert_eq_str("hello", "hello", "hello == hello")

    let passed: i64 = tfw_passed_count()
    if passed != 1 {
        println("FAIL: passed count should be 1")
        return 1
    }

    // Not equal - should fail
    tfw_assert_eq_str("foo", "bar", "foo != bar")

    let failed: i64 = tfw_failed_count()
    if failed != 1 {
        println("FAIL: failed count should be 1")
        return 1
    }

    println("PASS: test_assert_eq_strings")
    0
}

fn test_assert_ne() -> i64 {
    tfw_reset()

    // Not equal - should pass
    tfw_assert_ne_i64(1, 2, "1 != 2")

    let passed: i64 = tfw_passed_count()
    if passed != 1 {
        println("FAIL: passed count should be 1")
        return 1
    }

    // Equal - should fail
    tfw_assert_ne_i64(42, 42, "42 == 42")

    let failed: i64 = tfw_failed_count()
    if failed != 1 {
        println("FAIL: failed count should be 1")
        return 1
    }

    println("PASS: test_assert_ne")
    0
}

fn test_explicit_fail() -> i64 {
    tfw_reset()

    tfw_fail("intentional failure")

    let failed: i64 = tfw_failed_count()
    if failed != 1 {
        println("FAIL: failed count should be 1")
        return 1
    }

    println("PASS: test_explicit_fail")
    0
}

fn main() -> i64 {
    println("=== Test Framework Tests ===")
    println("")

    var failures: i64 = 0

    failures = failures + test_reset_and_counters()
    failures = failures + test_tfw_assert_true()
    failures = failures + test_tfw_assert_false()
    failures = failures + test_assert_eq_integers()
    failures = failures + test_assert_eq_strings()
    failures = failures + test_assert_ne()
    failures = failures + test_explicit_fail()

    println("")
    if failures == 0 {
        println("All Test Framework tests passed!")
    } else {
        print("Test Framework tests failed: ")
        println(int_to_string(failures))
    }

    failures
}
