<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 400" width="850" height="400">
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <linearGradient id="inputGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#ff6b35"/>
      <stop offset="100%" style="stop-color:#ff8c42"/>
    </linearGradient>
    <linearGradient id="cacheGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#00ff88"/>
      <stop offset="100%" style="stop-color:#00b359"/>
    </linearGradient>
    <linearGradient id="batchGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#00d9ff"/>
      <stop offset="100%" style="stop-color:#0077b6"/>
    </linearGradient>
    <linearGradient id="llamaGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9d4edd"/>
      <stop offset="100%" style="stop-color:#7b2cbf"/>
    </linearGradient>
    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8892b0"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="850" height="400" fill="url(#bgGradient)"/>

  <!-- Title -->
  <text x="425" y="30" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="20" font-weight="bold">High-Performance Inference Pipeline (llama.cpp)</text>

  <!-- Input Stage -->
  <g transform="translate(30, 70)">
    <rect x="0" y="0" width="120" height="100" rx="8" fill="url(#inputGradient)" filter="url(#glow)"/>
    <text x="60" y="25" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Requests</text>
    <rect x="15" y="35" width="90" height="18" rx="3" fill="#1a1a2e" opacity="0.5"/>
    <text x="60" y="48" text-anchor="middle" fill="#ffccaa" font-family="Arial, sans-serif" font-size="9">Prompt 1</text>
    <rect x="15" y="55" width="90" height="18" rx="3" fill="#1a1a2e" opacity="0.5"/>
    <text x="60" y="68" text-anchor="middle" fill="#ffccaa" font-family="Arial, sans-serif" font-size="9">Prompt 2</text>
    <rect x="15" y="75" width="90" height="18" rx="3" fill="#1a1a2e" opacity="0.5"/>
    <text x="60" y="88" text-anchor="middle" fill="#ffccaa" font-family="Arial, sans-serif" font-size="9">Prompt 3</text>
  </g>

  <!-- Arrow -->
  <line x1="155" y1="120" x2="185" y2="120" stroke="#8892b0" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Prompt Cache -->
  <g transform="translate(190, 70)">
    <rect x="0" y="0" width="130" height="100" rx="8" fill="url(#cacheGradient)" filter="url(#glow)"/>
    <text x="65" y="22" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Prompt Cache</text>
    <text x="65" y="40" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10">KV-cache reuse</text>
    <rect x="15" y="50" width="100" height="40" rx="4" fill="#1a1a2e" opacity="0.4"/>
    <text x="65" y="68" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">Hit: Skip tokenization</text>
    <text x="65" y="82" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">Miss: Full processing</text>
  </g>

  <!-- Arrow -->
  <line x1="325" y1="120" x2="355" y2="120" stroke="#8892b0" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Continuous Batching -->
  <g transform="translate(360, 55)">
    <rect x="0" y="0" width="150" height="130" rx="8" fill="url(#batchGradient)" filter="url(#glow)"/>
    <text x="75" y="22" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Continuous</text>
    <text x="75" y="38" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Batching</text>

    <rect x="15" y="50" width="120" height="70" rx="4" fill="#1a1a2e" opacity="0.4"/>
    <text x="75" y="68" text-anchor="middle" fill="#cceeff" font-family="Arial, sans-serif" font-size="9">max_batch: 8</text>
    <text x="75" y="82" text-anchor="middle" fill="#cceeff" font-family="Arial, sans-serif" font-size="9">timeout: 50ms</text>
    <text x="75" y="96" text-anchor="middle" fill="#cceeff" font-family="Arial, sans-serif" font-size="9">Dynamic insertion</text>
    <text x="75" y="110" text-anchor="middle" fill="#cceeff" font-family="Arial, sans-serif" font-size="9">Early return</text>
  </g>

  <!-- Arrow -->
  <line x1="515" y1="120" x2="545" y2="120" stroke="#8892b0" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- llama.cpp Engine -->
  <g transform="translate(550, 55)">
    <rect x="0" y="0" width="150" height="130" rx="8" fill="url(#llamaGradient)" filter="url(#glow)"/>
    <text x="75" y="22" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">llama.cpp</text>
    <text x="75" y="38" text-anchor="middle" fill="#e0c3fc" font-family="Arial, sans-serif" font-size="10">Native Bindings</text>

    <rect x="15" y="48" width="120" height="72" rx="4" fill="#1a1a2e" opacity="0.4"/>
    <text x="75" y="64" text-anchor="middle" fill="#e0c3fc" font-family="Arial, sans-serif" font-size="9">GGUF model format</text>
    <text x="75" y="78" text-anchor="middle" fill="#e0c3fc" font-family="Arial, sans-serif" font-size="9">GPU offload (32 layers)</text>
    <text x="75" y="92" text-anchor="middle" fill="#e0c3fc" font-family="Arial, sans-serif" font-size="9">Flash Attention</text>
    <text x="75" y="106" text-anchor="middle" fill="#e0c3fc" font-family="Arial, sans-serif" font-size="9">Metal/CUDA/CPU</text>
  </g>

  <!-- Arrow -->
  <line x1="705" y1="120" x2="735" y2="120" stroke="#8892b0" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Output -->
  <g transform="translate(740, 70)">
    <rect x="0" y="0" width="90" height="100" rx="8" fill="#0f3460" stroke="#00ff88" stroke-width="2"/>
    <text x="45" y="25" text-anchor="middle" fill="#00ff88" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Output</text>
    <rect x="10" y="35" width="70" height="55" rx="3" fill="#1a1a2e" opacity="0.5"/>
    <text x="45" y="52" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">Streaming</text>
    <text x="45" y="66" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">tokens</text>
    <text x="45" y="82" text-anchor="middle" fill="#00ff88" font-family="Arial, sans-serif" font-size="10">&#8595;</text>
  </g>

  <!-- Response Cache (below) -->
  <g transform="translate(550, 210)">
    <rect x="0" y="0" width="150" height="70" rx="8" fill="url(#cacheGradient)" filter="url(#glow)"/>
    <text x="75" y="22" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Response Cache</text>
    <rect x="15" y="32" width="120" height="30" rx="4" fill="#1a1a2e" opacity="0.4"/>
    <text x="75" y="48" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">10,000 entries</text>
    <text x="75" y="60" text-anchor="middle" fill="#ccffdd" font-family="Arial, sans-serif" font-size="9">TTL: 1 hour</text>
  </g>

  <!-- Arrow from llama.cpp to cache -->
  <line x1="625" y1="185" x2="625" y2="205" stroke="#8892b0" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Performance Stats Box -->
  <rect x="30" y="210" width="300" height="170" rx="8" fill="#0f3460" opacity="0.7"/>
  <text x="180" y="235" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Performance Characteristics</text>

  <g transform="translate(50, 250)">
    <circle cx="8" cy="8" r="4" fill="#00ff88"/>
    <text x="25" y="12" fill="#8892b0" font-family="Arial, sans-serif" font-size="11"><tspan font-weight="bold" fill="#00ff88">Throughput:</tspan> 8x batch improvement</text>
  </g>

  <g transform="translate(50, 275)">
    <circle cx="8" cy="8" r="4" fill="#00d9ff"/>
    <text x="25" y="12" fill="#8892b0" font-family="Arial, sans-serif" font-size="11"><tspan font-weight="bold" fill="#00d9ff">Latency:</tspan> &lt;100ms first token (cached)</text>
  </g>

  <g transform="translate(50, 300)">
    <circle cx="8" cy="8" r="4" fill="#9d4edd"/>
    <text x="25" y="12" fill="#8892b0" font-family="Arial, sans-serif" font-size="11"><tspan font-weight="bold" fill="#9d4edd">Memory:</tspan> 4.1GB for 7B model</text>
  </g>

  <g transform="translate(50, 325)">
    <circle cx="8" cy="8" r="4" fill="#ff6b35"/>
    <text x="25" y="12" fill="#8892b0" font-family="Arial, sans-serif" font-size="11"><tspan font-weight="bold" fill="#ff6b35">GPU Offload:</tspan> Configurable layers</text>
  </g>

  <g transform="translate(50, 350)">
    <circle cx="8" cy="8" r="4" fill="#ffffff"/>
    <text x="25" y="12" fill="#8892b0" font-family="Arial, sans-serif" font-size="11"><tspan font-weight="bold" fill="#ffffff">Backends:</tspan> CUDA, Metal, CPU</text>
  </g>

  <!-- Code snippet -->
  <rect x="360" y="300" width="460" height="80" rx="6" fill="#1a1a2e" stroke="#4a5568" stroke-width="1"/>
  <text x="380" y="320" fill="#00d9ff" font-family="monospace" font-size="10">let pipeline = InferencePipeline::builder()</text>
  <text x="380" y="335" fill="#00d9ff" font-family="monospace" font-size="10">    .with_model("simplex-cognitive-7b.gguf", config)</text>
  <text x="380" y="350" fill="#00d9ff" font-family="monospace" font-size="10">    .with_batching(BatchConfig { max_size: 8 })</text>
  <text x="380" y="365" fill="#00d9ff" font-family="monospace" font-size="10">    .with_prompt_cache(1000).build();</text>

  <!-- Footer -->
  <text x="425" y="395" text-anchor="middle" fill="#4a5568" font-family="Arial, sans-serif" font-size="10">SIMPLEX v0.9.0 - High-Performance Inference via simplex-inference</text>
</svg>
