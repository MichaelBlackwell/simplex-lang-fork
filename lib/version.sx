// Simplex Version Constants
// Single source of truth for all version information
// Duplicates VERSION() from 11+ locations across codebase
//
// Copyright (c) 2025-2026 Rod Higgins
// Licensed under AGPL-3.0 - see LICENSE file
// https://github.com/senuamedia/simplex

// Import platform module for platform detection functions
use platform;

// Core Version Constants
// ========================================

// Main Simplex version - replaces 11+ duplicate VERSION() functions
pub fn SIMPLEX_VERSION() -> i64 { string_from("0.9.9") }

// Toolchain version for compiler and tools
pub fn TOOLCHAIN_VERSION() -> i64 { string_from("0.9.9") }

// Runtime version for standalone_runtime.c
pub fn RUNTIME_VERSION() -> i64 { string_from("0.9.9") }

// Language specification version
pub fn LANGUAGE_VERSION() -> i64 { string_from("0.9.9") }

// Package manager version
pub fn SXPM_VERSION() -> i64 { string_from("0.9.9") }

// Documentation generator version
pub fn SXDOC_VERSION() -> i64 { string_from("0.9.9") }

// Language server version
pub fn SXLSP_VERSION() -> i64 { string_from("0.9.9") }

// Bytecode VM version
pub fn CURSUS_VERSION() -> i64 { string_from("0.9.9") }

// Component Versions
// ========================================

// Compiler bootstrap version
pub fn COMPILER_VERSION() -> i64 { string_from("0.9.9") }

// Standard library version
pub fn STDLIB_VERSION() -> i64 { string_from("0.9.9") }

// Neural IR version
pub fn NEURAL_IR_VERSION() -> i64 { string_from("0.9.9") }

// Dual numbers version
pub fn DUAL_NUMBERS_VERSION() -> i64 { string_from("0.9.9") }

// Learning framework version
pub fn LEARNING_VERSION() -> i64 { string_from("0.9.9") }

// Training pipeline version
pub fn TRAINING_VERSION() -> i64 { string_from("0.9.9") }

// Compatibility Versions
// ========================================

// Minimum compatible version
pub fn MIN_COMPATIBLE_VERSION() -> i64 { string_from("0.8.0") }

// Maximum compatible version for current ABI
pub fn MAX_COMPATIBLE_VERSION() -> i64 { string_from("0.10.0") }

// LLVM version requirement
pub fn LLVM_MIN_VERSION() -> i64 { string_from("14.0.0") }

// Version Comparison Utilities
// ========================================

// Parse version string into components
// Returns: major * 10000 + minor * 100 + patch
pub fn parse_version(version: i64) -> i64 {
    let parts: i64 = string_split(version, string_from("."));
    if vec_len(parts) < 2 {
        return 0;
    }
    
    let major_str: i64 = vec_get(parts, 0);
    let minor_str: i64 = vec_get(parts, 1);
    let patch_str: i64 = string_from("0");
    
    if vec_len(parts) >= 3 {
        patch_str = vec_get(parts, 2);
    }
    
    let major: i64 = string_to_int(major_str);
    let minor: i64 = string_to_int(minor_str);
    let patch: i64 = string_to_int(patch_str);
    
    return major * 10000 + minor * 100 + patch;
}

// Check if version meets minimum requirement
pub fn version_meets_min(current: i64, minimum: i64) -> bool {
    let current_num: i64 = parse_version(current);
    let minimum_num: i64 = parse_version(minimum);
    current_num >= minimum_num
}

// Check if version is compatible with range
pub fn is_version_compatible(version: i64, min: i64, max: i64) -> bool {
    let version_num: i64 = parse_version(version);
    let min_num: i64 = parse_version(min);
    let max_num: i64 = parse_version(max);
    version_num >= min_num && version_num <= max_num
}

// Version Strings for Display
// ========================================

// Full version string with name
pub fn get_full_version_string() -> i64 {
    string_concat(string_from("Simplex "), SIMPLEX_VERSION())
}

// Compiler version string for CLI
pub fn get_compiler_version_string() -> i64 {
    string_concat(string_from("sxc "), TOOLCHAIN_VERSION())
}

// Package manager version string
pub fn get_sxpm_version_string() -> i64 {
    string_concat(string_from("sxpm "), SXPM_VERSION())
}

// Language server version string
pub fn get_sxlsp_version_string() -> i64 {
    string_concat(string_from("sxlsp "), SXLSP_VERSION())
}

// Documentation generator version string
pub fn get_sxdoc_version_string() -> i64 {
    string_concat(string_from("sxdoc "), SXDOC_VERSION())
}

// Bytecode VM version string
pub fn get_cursus_version_string() -> i64 {
    string_concat(string_from("cursus "), CURSUS_VERSION())
}

// Build Information
// ========================================

// Build timestamp (would be set during build)
pub fn BUILD_TIMESTAMP() -> i64 { string_from("2026-01-18T12:00:00Z") }

// Build target (platform/architecture)
pub fn BUILD_TARGET() -> i64 { 
    string_concat(get_platform_name(), string_concat(string_from("-"), get_arch_name()))
}

// Get platform name for build target
pub fn get_platform_name() -> i64 {
    let os: i64 = platform::get_os_name();
    if string_eq(os, string_from("windows")) {
        return string_from("windows");
    } else if string_eq(os, string_from("macos")) {
        return string_from("darwin");
    } else if string_eq(os, string_from("linux")) {
        return string_from("linux");
    } else {
        return string_from("unknown");
    }
}

// Get architecture name for build target
pub fn get_arch_name() -> i64 {
    platform::get_arch_name()
}

// Feature Flags by Version
// ========================================

// Check if neural gates are supported
pub fn has_neural_gates() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.6.0"))
}

// Check if dual numbers are supported
pub fn has_dual_numbers() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.8.0"))
}

// Check if real-time learning is supported
pub fn has_realtime_learning() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.7.0"))
}

// Check if self-learning annealing is supported
pub fn has_self_learning_annealing() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.9.9"))
}

// Check if actors are supported
pub fn has_actors() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.5.0"))
}

// Check if async/await is supported
pub fn has_async_await() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.4.0"))
}

// Check if cognitive agents are supported
pub fn has_cognitive_agents() -> bool {
    version_meets_min(SIMPLEX_VERSION(), string_from("0.5.0"))
}

// Version History
// ========================================

// Get release notes URL for version
pub fn get_release_notes_url(version: i64) -> i64 {
    string_concat(string_from("https://github.com/senuamedia/simplex-lang/releases/tag/v"), version)
}

// Get documentation URL for version
pub fn get_documentation_url(version: i64) -> i64 {
    string_concat(string_from("https://simplex-lang.org/v"), version)
}

// Check if version is pre-release
pub fn is_prerelease(version: i64) -> bool {
    string_contains(version, string_from("-alpha")) || 
    string_contains(version, string_from("-beta")) ||
    string_contains(version, string_from("-rc"))
}