// Test file for HashMap operations
// Tests: hashmap_new, hashmap_insert, hashmap_get, hashmap_contains, hashmap_remove, etc.

fn test_hashmap_create() -> i64 {
    let m: i64 = hashmap_new();

    if hashmap_len(m) != 0 {
        println("FAIL: new hashmap should be empty");
        return 1;
    }

    if hashmap_is_empty(m) == false {
        println("FAIL: new hashmap is_empty should be true");
        return 1;
    }

    println("PASS: test_hashmap_create");
    0
}

fn test_hashmap_insert_get() -> i64 {
    let m: i64 = hashmap_new();

    hashmap_insert(m, "key1", 100);
    hashmap_insert(m, "key2", 200);
    hashmap_insert(m, "key3", 300);

    if hashmap_len(m) != 3 {
        println("FAIL: hashmap should have 3 entries");
        return 1;
    }

    let opt1: i64 = hashmap_get(m, "key1");
    if option_is_none(opt1) {
        println("FAIL: key1 should exist");
        return 1;
    }
    if option_unwrap(opt1) != 100 {
        println("FAIL: key1 value should be 100");
        return 1;
    }

    let opt2: i64 = hashmap_get(m, "key2");
    if option_unwrap(opt2) != 200 {
        println("FAIL: key2 value should be 200");
        return 1;
    }

    let opt3: i64 = hashmap_get(m, "key3");
    if option_unwrap(opt3) != 300 {
        println("FAIL: key3 value should be 300");
        return 1;
    }

    println("PASS: test_hashmap_insert_get");
    0
}

fn test_hashmap_contains() -> i64 {
    let m: i64 = hashmap_new();
    hashmap_insert(m, "exists", 42);

    if hashmap_contains(m, "exists") == false {
        println("FAIL: should contain 'exists'");
        return 1;
    }

    if hashmap_contains(m, "missing") == true {
        println("FAIL: should not contain 'missing'");
        return 1;
    }

    println("PASS: test_hashmap_contains");
    0
}

fn test_hashmap_remove() -> i64 {
    let m: i64 = hashmap_new();
    hashmap_insert(m, "key", 999);

    if hashmap_len(m) != 1 {
        println("FAIL: should have 1 entry");
        return 1;
    }

    let removed: i64 = hashmap_remove(m, "key");
    if option_is_none(removed) {
        println("FAIL: remove should return Some");
        return 1;
    }
    if option_unwrap(removed) != 999 {
        println("FAIL: removed value should be 999");
        return 1;
    }

    if hashmap_len(m) != 0 {
        println("FAIL: should be empty after remove");
        return 1;
    }

    // Remove non-existent key
    let removed2: i64 = hashmap_remove(m, "missing");
    if option_is_some(removed2) {
        println("FAIL: remove missing should return None");
        return 1;
    }

    println("PASS: test_hashmap_remove");
    0
}

fn test_hashmap_update() -> i64 {
    let m: i64 = hashmap_new();
    hashmap_insert(m, "key", 100);

    // Update existing key
    hashmap_insert(m, "key", 200);

    if hashmap_len(m) != 1 {
        println("FAIL: should still have 1 entry after update");
        return 1;
    }

    let opt: i64 = hashmap_get(m, "key");
    if option_unwrap(opt) != 200 {
        println("FAIL: value should be updated to 200");
        return 1;
    }

    println("PASS: test_hashmap_update");
    0
}

fn test_hashmap_clear() -> i64 {
    let m: i64 = hashmap_new();
    hashmap_insert(m, "a", 1);
    hashmap_insert(m, "b", 2);
    hashmap_insert(m, "c", 3);

    hashmap_clear(m);

    if hashmap_len(m) != 0 {
        println("FAIL: should be empty after clear");
        return 1;
    }

    if hashmap_is_empty(m) == false {
        println("FAIL: is_empty should be true after clear");
        return 1;
    }

    println("PASS: test_hashmap_clear");
    0
}

fn test_hashmap_get_missing() -> i64 {
    let m: i64 = hashmap_new();
    hashmap_insert(m, "key", 42);

    let opt: i64 = hashmap_get(m, "nonexistent");
    if option_is_some(opt) {
        println("FAIL: get missing key should return None");
        return 1;
    }

    println("PASS: test_hashmap_get_missing");
    0
}

fn test_hashmap_many_entries() -> i64 {
    let m: i64 = hashmap_new();

    // Insert 50 entries
    var i: i64 = 0;
    while i < 50 {
        let key: i64 = string_concat("key", int_to_string(i));
        hashmap_insert(m, key, i * 10);
        i = i + 1;
    }

    if hashmap_len(m) != 50 {
        println("FAIL: should have 50 entries");
        return 1;
    }

    // Verify some entries
    let opt0: i64 = hashmap_get(m, "key0");
    if option_unwrap(opt0) != 0 {
        println("FAIL: key0 should be 0");
        return 1;
    }

    let opt25: i64 = hashmap_get(m, "key25");
    if option_unwrap(opt25) != 250 {
        println("FAIL: key25 should be 250");
        return 1;
    }

    let opt49: i64 = hashmap_get(m, "key49");
    if option_unwrap(opt49) != 490 {
        println("FAIL: key49 should be 490");
        return 1;
    }

    println("PASS: test_hashmap_many_entries");
    0
}

fn test_int_hashmap() -> i64 {
    let m: i64 = int_hashmap_new();

    int_hashmap_insert(m, 1, 100);
    int_hashmap_insert(m, 2, 200);
    int_hashmap_insert(m, 3, 300);

    if int_hashmap_len(m) != 3 {
        println("FAIL: int hashmap should have 3 entries");
        return 1;
    }

    let opt: i64 = int_hashmap_get(m, 2);
    if option_unwrap(opt) != 200 {
        println("FAIL: key 2 should be 200");
        return 1;
    }

    if int_hashmap_contains(m, 1) == false {
        println("FAIL: should contain key 1");
        return 1;
    }

    if int_hashmap_contains(m, 999) == true {
        println("FAIL: should not contain key 999");
        return 1;
    }

    println("PASS: test_int_hashmap");
    0
}

fn main() -> i64 {
    println("=== HashMap Tests ===");
    println("");

    var failures: i64 = 0;

    failures = failures + test_hashmap_create();
    failures = failures + test_hashmap_insert_get();
    failures = failures + test_hashmap_contains();
    failures = failures + test_hashmap_remove();
    failures = failures + test_hashmap_update();
    failures = failures + test_hashmap_clear();
    failures = failures + test_hashmap_get_missing();
    failures = failures + test_hashmap_many_entries();
    failures = failures + test_int_hashmap();

    println("");
    if failures == 0 {
        println("All HashMap tests passed!");
    } else {
        print("HashMap tests failed: ");
        println(int_to_string(failures));
    }

    failures
}
