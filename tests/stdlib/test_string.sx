// Test file for String operations
// Tests: string_len, string_concat, string_eq, string_contains, string_split, etc.

fn test_string_len() -> i64 {
    let s: i64 = "hello";
    if string_len(s) != 5 {
        println("FAIL: string_len of 'hello' should be 5");
        return 1;
    }

    let empty: i64 = "";
    if string_len(empty) != 0 {
        println("FAIL: string_len of '' should be 0");
        return 1;
    }

    println("PASS: test_string_len");
    0
}

fn test_string_concat() -> i64 {
    let a: i64 = "hello";
    let b: i64 = " world";
    let result: i64 = string_concat(a, b);

    if string_eq(result, "hello world") == false {
        println("FAIL: concat should produce 'hello world'");
        return 1;
    }

    println("PASS: test_string_concat");
    0
}

fn test_string_eq() -> i64 {
    let a: i64 = "test";
    let b: i64 = "test";
    let c: i64 = "other";

    if string_eq(a, b) == false {
        println("FAIL: 'test' should equal 'test'");
        return 1;
    }

    if string_eq(a, c) == true {
        println("FAIL: 'test' should not equal 'other'");
        return 1;
    }

    println("PASS: test_string_eq");
    0
}

fn test_string_contains() -> i64 {
    let s: i64 = "hello world";

    if string_contains(s, "world") == false {
        println("FAIL: 'hello world' should contain 'world'");
        return 1;
    }

    if string_contains(s, "xyz") == true {
        println("FAIL: 'hello world' should not contain 'xyz'");
        return 1;
    }

    println("PASS: test_string_contains");
    0
}

fn test_string_starts_with() -> i64 {
    let s: i64 = "hello world";

    if string_starts_with(s, "hello") == false {
        println("FAIL: should start with 'hello'");
        return 1;
    }

    if string_starts_with(s, "world") == true {
        println("FAIL: should not start with 'world'");
        return 1;
    }

    println("PASS: test_string_starts_with");
    0
}

fn test_string_ends_with() -> i64 {
    let s: i64 = "hello world";

    if string_ends_with(s, "world") == false {
        println("FAIL: should end with 'world'");
        return 1;
    }

    if string_ends_with(s, "hello") == true {
        println("FAIL: should not end with 'hello'");
        return 1;
    }

    println("PASS: test_string_ends_with");
    0
}

fn test_string_substring() -> i64 {
    let s: i64 = "hello world";
    let sub: i64 = string_substring(s, 0, 5);

    if string_eq(sub, "hello") == false {
        println("FAIL: substring(0,5) should be 'hello'");
        return 1;
    }

    let sub2: i64 = string_substring(s, 6, 11);
    if string_eq(sub2, "world") == false {
        println("FAIL: substring(6,11) should be 'world'");
        return 1;
    }

    println("PASS: test_string_substring");
    0
}

fn test_string_char_at() -> i64 {
    let s: i64 = "abc";

    if string_char_at(s, 0) != 97 {
        println("FAIL: char_at(0) should be 'a' (97)");
        return 1;
    }
    if string_char_at(s, 1) != 98 {
        println("FAIL: char_at(1) should be 'b' (98)");
        return 1;
    }
    if string_char_at(s, 2) != 99 {
        println("FAIL: char_at(2) should be 'c' (99)");
        return 1;
    }

    println("PASS: test_string_char_at");
    0
}

fn test_string_find() -> i64 {
    let s: i64 = "hello world";

    let idx1: i64 = string_find(s, "world");
    if idx1 != 6 {
        println("FAIL: find('world') should return 6");
        return 1;
    }

    let idx2: i64 = string_find(s, "xyz");
    if idx2 != 0 - 1 {
        println("FAIL: find('xyz') should return -1");
        return 1;
    }

    println("PASS: test_string_find");
    0
}

fn test_string_split() -> i64 {
    let s: i64 = "a,b,c";
    let parts: i64 = string_split(s, ",");

    if vec_len(parts) != 3 {
        println("FAIL: split should produce 3 parts");
        return 1;
    }

    if string_eq(vec_get(parts, 0), "a") == false {
        println("FAIL: first part should be 'a'");
        return 1;
    }
    if string_eq(vec_get(parts, 1), "b") == false {
        println("FAIL: second part should be 'b'");
        return 1;
    }
    if string_eq(vec_get(parts, 2), "c") == false {
        println("FAIL: third part should be 'c'");
        return 1;
    }

    println("PASS: test_string_split");
    0
}

fn test_string_join() -> i64 {
    let v: i64 = vec_new();
    vec_push(v, "one");
    vec_push(v, "two");
    vec_push(v, "three");

    let result: i64 = string_join(v, "-");

    if string_eq(result, "one-two-three") == false {
        println("FAIL: join should produce 'one-two-three'");
        return 1;
    }

    println("PASS: test_string_join");
    0
}

fn test_string_replace() -> i64 {
    let s: i64 = "hello world world";
    let result: i64 = string_replace(s, "world", "there");

    if string_eq(result, "hello there there") == false {
        println("FAIL: replace should produce 'hello there there'");
        return 1;
    }

    println("PASS: test_string_replace");
    0
}

fn test_string_trim() -> i64 {
    let s: i64 = "  hello  ";
    let trimmed: i64 = string_trim(s);

    if string_eq(trimmed, "hello") == false {
        println("FAIL: trim should produce 'hello'");
        return 1;
    }

    println("PASS: test_string_trim");
    0
}

fn test_string_to_uppercase() -> i64 {
    let s: i64 = "hello";
    let upper: i64 = string_to_uppercase(s);

    if string_eq(upper, "HELLO") == false {
        println("FAIL: to_uppercase should produce 'HELLO'");
        return 1;
    }

    println("PASS: test_string_to_uppercase");
    0
}

fn test_string_to_lowercase() -> i64 {
    let s: i64 = "HELLO";
    let lower: i64 = string_to_lowercase(s);

    if string_eq(lower, "hello") == false {
        println("FAIL: to_lowercase should produce 'hello'");
        return 1;
    }

    println("PASS: test_string_to_lowercase");
    0
}

fn test_int_to_string() -> i64 {
    let s1: i64 = int_to_string(42);
    if string_eq(s1, "42") == false {
        println("FAIL: int_to_string(42) should be '42'");
        return 1;
    }

    let s2: i64 = int_to_string(0 - 123);
    if string_eq(s2, "-123") == false {
        println("FAIL: int_to_string(-123) should be '-123'");
        return 1;
    }

    println("PASS: test_int_to_string");
    0
}

fn test_string_to_int() -> i64 {
    let n1: i64 = string_to_int("42");
    if n1 != 42 {
        println("FAIL: string_to_int('42') should be 42");
        return 1;
    }

    let n2: i64 = string_to_int("-123");
    if n2 != 0 - 123 {
        println("FAIL: string_to_int('-123') should be -123");
        return 1;
    }

    println("PASS: test_string_to_int");
    0
}

fn main() -> i64 {
    println("=== String Tests ===");
    println("");

    var failures: i64 = 0;

    failures = failures + test_string_len();
    failures = failures + test_string_concat();
    failures = failures + test_string_eq();
    failures = failures + test_string_contains();
    failures = failures + test_string_starts_with();
    failures = failures + test_string_ends_with();
    failures = failures + test_string_substring();
    failures = failures + test_string_char_at();
    failures = failures + test_string_find();
    failures = failures + test_string_split();
    failures = failures + test_string_join();
    failures = failures + test_string_replace();
    failures = failures + test_string_trim();
    failures = failures + test_string_to_uppercase();
    failures = failures + test_string_to_lowercase();
    failures = failures + test_int_to_string();
    failures = failures + test_string_to_int();

    println("");
    if failures == 0 {
        println("All String tests passed!");
    } else {
        print("String tests failed: ");
        println(int_to_string(failures));
    }

    failures
}
