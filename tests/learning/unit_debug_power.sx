// Debug power function

struct Dual {
 val: f64,
 der: f64,
}

fn dual_variable(value: f64) -> Dual {
 Dual { val: value, der: 1.0 }
}

fn dual_powi(x: Dual, n: i64) -> Dual {
 println("dual_powi called");
 print(" x.val = ");
 print_f64(x.val);
 println("");
 print(" x.der = ");
 print_f64(x.der);
 println("");
 print(" n = ");
 print_i64(n);
 println("");

 let val: f64 = pow(x.val, n);
 print(" pow(x.val, n) = ");
 print_f64(val);
 println("");

 let nf: f64 = n as f64;
 print(" nf (n as f64) = ");
 print_f64(nf);
 println("");

 let nm1: i64 = n - 1;
 print(" n - 1 = ");
 print_i64(nm1);
 println("");

 let pow_nm1: f64 = pow(x.val, nm1);
 print(" pow(x.val, n-1) = ");
 print_f64(pow_nm1);
 println("");

 let der: f64 = x.der * nf * pow_nm1;
 print(" der = x.der * nf * pow_nm1 = ");
 print_f64(der);
 println("");

 Dual { val: val, der: der }
}

fn main() -> i64 {
 println("=== Debug Power Test ===");
 println("");

 // x^3 at x=2: value = 8, derivative = 3*xÂ² = 12
 let x: Dual = dual_variable(2.0);
 println("Created dual variable x=2.0");
 print(" x.val = ");
 print_f64(x.val);
 println("");
 print(" x.der = ");
 print_f64(x.der);
 println("");
 println("");

 let cube: Dual = dual_powi(x, 3);
 println("");
 println("Result:");
 print(" cube.val = ");
 print_f64(cube.val);
 print(" (expected: 8.0)");
 println("");
 print(" cube.der = ");
 print_f64(cube.der);
 print(" (expected: 12.0)");
 println("");

 0
}
