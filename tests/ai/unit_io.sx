// test_io.sx - Test I/O operations
// Rewritten to use supported syntax

fn test_stderr_write() -> i64 {
 println(" Testing stderr write...");

 stderr_write("Writing to stderr: ");
 stderr_writeln("Hello stderr!");

 println(" PASS: stderr write completed");
 0
}

fn test_file_write_read() -> i64 {
 println(" Testing file write/read...");

 let test_path: i64 = "/tmp/simplex_io_test.txt";
 let content: i64 = "Hello from Simplex I/O test!";
 file_write(test_path, content);

 // Check file exists
 let exists: i64 = file_exists(test_path);
 if exists == 1 {
 println(" PASS: file written and exists");
 remove_path(test_path);
 0
 } else {
 println(" FAIL: file not created");
 1
 }
}

fn test_file_read_content() -> i64 {
 println(" Testing file read content...");

 let test_path: i64 = "/tmp/simplex_read_test.txt";
 let content: i64 = "Test content here";
 file_write(test_path, content);

 let read_content: i64 = file_read(test_path);
 if string_len(read_content) > 0 {
 println(" PASS: file read returned content");
 remove_path(test_path);
 0
 } else {
 println(" FAIL: file read returned empty");
 remove_path(test_path);
 1
 }
}

fn test_file_cleanup() -> i64 {
 println(" Testing file cleanup...");

 let test_path: i64 = "/tmp/simplex_cleanup_test.txt";
 file_write(test_path, "temp content");

 // Delete the file
 file_delete(test_path);

 // Verify it's gone
 let still_exists: i64 = file_exists(test_path);
 if still_exists == 0 {
 println(" PASS: file deleted successfully");
 0
 } else {
 println(" FAIL: file still exists");
 1
 }
}

fn main() -> i64 {
 println("=== I/O Operations Test ===");
 println("");

 var failures: i64 = 0;

 failures = failures + test_stderr_write();
 failures = failures + test_file_write_read();
 failures = failures + test_file_read_content();
 failures = failures + test_file_cleanup();

 println("");
 if failures == 0 {
 println("=== ALL I/O TESTS PASSED ===");
 } else {
 println("=== I/O TESTS FAILED ===");
 }

 failures
}
