// Test file for Actor-Anima Integration
// Phase 4.10: Cognitive Actors

// External declarations
fn cognitive_actor_new(actor_id: i64, name: i64, personality: i64) -> i64;
fn cognitive_actor_get_anima(ca: i64) -> i64;
fn cognitive_actor_set_tools(ca: i64, tools: i64);
fn cognitive_actor_set_provider(ca: i64, provider: i64);
fn cognitive_actor_set_auto_learn(ca: i64, enabled: i64);
fn cognitive_actor_set_auto_remember(ca: i64, enabled: i64);
fn cognitive_actor_set_threshold(ca: i64, threshold: f64);
fn cognitive_actor_get_personality(ca: i64) -> i64;
fn cognitive_actor_set_personality(ca: i64, personality: i64);
fn cognitive_actor_remember(ca: i64, content: i64, importance: f64) -> i64;
fn cognitive_actor_learn(ca: i64, content: i64, confidence: f64, source: i64) -> i64;
fn cognitive_actor_believe(ca: i64, content: i64, confidence: f64, evidence: i64) -> i64;
fn cognitive_actor_recall(ca: i64, goal: i64, context: i64) -> i64;
fn cognitive_actor_process_interaction(ca: i64, user_msg: i64, assistant_msg: i64, importance: f64) -> i64;
fn cognitive_actor_get_context(ca: i64, query: i64) -> i64;
fn cognitive_actor_build_prompt(ca: i64, query: i64) -> i64;
fn cognitive_team_new(name: i64) -> i64;
fn cognitive_team_add(team: i64, ca: i64) -> i64;
fn cognitive_team_share(team: i64, ca: i64, knowledge: i64, importance: f64) -> i64;
fn cognitive_team_size(team: i64) -> i64;
fn cognitive_team_get_shared(team: i64) -> i64;
fn cognitive_team_recall(team: i64, ca: i64, goal: i64) -> i64;
fn cognitive_team_close(team: i64);
fn cognitive_actor_save(ca: i64, path: i64) -> i64;
fn cognitive_actor_load(path: i64) -> i64;
fn cognitive_actor_close(ca: i64);
fn cognitive_actor_info(ca: i64) -> i64;

// Anima memory functions
fn anima_episodic_count(mem: i64) -> i64;
fn anima_semantic_count(mem: i64) -> i64;
fn anima_beliefs_count(mem: i64) -> i64;

fn main() {
    println("=== Actor-Anima Integration Test ===");
    println("");

    // Create a cognitive actor
    println("--- Creating Cognitive Actor ---");
    let personality: i64 = string_from("You are a helpful AI assistant with memory.");
    let ca: i64 = cognitive_actor_new(1, string_from("assistant"), personality);

    if ca != 0 {
        println("Created cognitive actor");
    }

    // Get personality
    let pers: i64 = cognitive_actor_get_personality(ca);
    print("Personality: ");
    print_string(pers);
    println("");

    // Configure the actor
    cognitive_actor_set_threshold(ca, 0.3);  // Lower threshold for testing
    cognitive_actor_set_auto_learn(ca, 1);
    cognitive_actor_set_auto_remember(ca, 1);

    // Get actor info
    let info: i64 = cognitive_actor_info(ca);
    println("");
    print("Actor info: ");
    print_string(info);
    println("");

    // Test remembering
    println("");
    println("--- Testing Memory Operations ---");
    cognitive_actor_remember(ca, string_from("User asked about Simplex programming"), 0.8);
    cognitive_actor_remember(ca, string_from("Explained how functions work"), 0.7);
    cognitive_actor_remember(ca, string_from("User was interested in AI features"), 0.9);

    // Test learning
    cognitive_actor_learn(ca, string_from("Simplex uses LLVM for code generation"), 0.95, string_from("documentation"));
    cognitive_actor_learn(ca, string_from("Anima provides cognitive memory"), 0.9, string_from("system"));

    // Test believing
    cognitive_actor_believe(ca, string_from("User prefers detailed explanations"), 0.7, 0);

    // Get updated info
    let info2: i64 = cognitive_actor_info(ca);
    print("Updated info: ");
    print_string(info2);
    println("");

    // Test recall
    println("");
    println("--- Testing Recall ---");
    let memories: i64 = cognitive_actor_recall(ca, string_from("Simplex programming"), 0);
    print("Recalled memories: ");
    print_string(memories);
    println("");

    // Test context building
    println("");
    println("--- Testing Context Building ---");
    let context: i64 = cognitive_actor_get_context(ca, string_from("How do I use AI features?"));
    print("Context: ");
    print_string(context);
    println("");

    // Test prompt building
    println("");
    println("--- Testing Prompt Building ---");
    let prompt: i64 = cognitive_actor_build_prompt(ca, string_from("How do actors work?"));
    print("Built prompt:\n");
    print_string(prompt);
    println("");

    // Test interaction processing
    println("");
    println("--- Testing Interaction Processing ---");
    let user_msg: i64 = string_from("Can you explain the actor model?");
    let asst_msg: i64 = string_from("The actor model is a concurrency paradigm.");
    cognitive_actor_process_interaction(ca, user_msg, asst_msg, 0.8);
    println("Processed interaction");

    // Create a second cognitive actor
    println("");
    println("--- Creating Team ---");
    let pers2: i64 = string_from("You are a research assistant.");
    let ca2: i64 = cognitive_actor_new(2, string_from("researcher"), pers2);
    println("Created second cognitive actor");

    // Create a team
    let team: i64 = cognitive_team_new(string_from("dev_team"));
    cognitive_team_add(team, ca);
    cognitive_team_add(team, ca2);

    print("Team size: ");
    print_i64(cognitive_team_size(team));
    println("");

    // Share knowledge with team
    let k1: i64 = string_from("Discovered: Simplex supports async/await");
    let k2: i64 = string_from("Found: Code generation uses LLVM IR");
    cognitive_team_share(team, ca, k1, 0.9);
    cognitive_team_share(team, ca2, k2, 0.85);
    println("Shared knowledge with team");

    // Test persistence
    println("");
    println("--- Testing Persistence ---");
    let save_path: i64 = string_from("/tmp/test_cognitive_actor.json");
    let saved: i64 = cognitive_actor_save(ca, save_path);
    if saved == 1 {
        println("Successfully saved cognitive actor");
    }

    // Load the actor back
    let loaded_ca: i64 = cognitive_actor_load(save_path);
    if loaded_ca != 0 {
        println("Successfully loaded cognitive actor");
        let loaded_info: i64 = cognitive_actor_info(loaded_ca);
        print("Loaded actor info: ");
        print_string(loaded_info);
        println("");
        cognitive_actor_close(loaded_ca);
    }

    // Cleanup
    cognitive_team_close(team);
    cognitive_actor_close(ca);
    cognitive_actor_close(ca2);

    println("");
    println("=== Actor-Anima Integration Test Complete! ===");
}
