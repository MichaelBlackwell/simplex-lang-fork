// Test for infer() outside specialist context
// This tests the "default model" code path in stage0.py
// Added as part of BUG-001 fix

fn test_infer_in_function() -> i64 {
    println("Testing infer() in regular function...");

    // This should work - infer() outside specialist uses "default" model
    let response = infer("What is 2 + 2?");

    if response != 0 {
        print("Response: ");
        print_string(response);
        println("");
        println("PASS: infer() works outside specialist");
        return 1;
    } else {
        println("FAIL: infer() returned null");
        return 0;
    }
}

fn test_infer_with_concat() -> i64 {
    println("Testing infer() with string concatenation...");

    let prompt = string_concat("Explain ", "briefly");
    let response = infer(prompt);

    if response != 0 {
        println("PASS: infer() works with dynamic prompt");
        return 1;
    } else {
        println("FAIL: infer() with concat returned null");
        return 0;
    }
}

fn main() -> i64 {
    println("=== Testing infer() Outside Specialist Context ===");
    println("");

    let passed = 0;
    let total = 2;

    passed = passed + test_infer_in_function();
    println("");
    passed = passed + test_infer_with_concat();

    println("");
    print("Results: ");
    print_i64(passed);
    print("/");
    print_i64(total);
    println(" tests passed");

    if passed == total {
        println("=== ALL TESTS PASSED ===");
        0
    } else {
        println("=== SOME TESTS FAILED ===");
        1
    }
}
