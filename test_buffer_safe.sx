// Test buffer overflow protection without string concatenation
fn main() -> i64 {
    println("=== Buffer Overflow Safety Test ===");
    
    // Test 1: Simple string (no concatenation)
    let simple = intrinsic_string_new("Hello, Simplex!");
    let simple_len = intrinsic_string_len(simple);
    println(intrinsic_string_concat("Simple string length: ", int_to_string(simple_len)));
    
    // Test 2: Medium string (safe allocation)
    let medium_content = "This is a medium-length test string to verify safe allocation handling in the runtime without causing buffer overflows or memory corruption issues.";
    let medium = intrinsic_string_new(medium_content);
    let medium_len = intrinsic_string_len(medium);
    println(intrinsic_string_concat("Medium string length: ", int_to_string(medium_len)));
    
    // Test 3: Large string creation (stress test)
    var large_len = 0;
    let large_content = "Large string stress test chunk ";
    
    // Build a large string using builder (safer than concatenation)
    let sb = intrinsic_string_builder_new();
    var i = 0;
    while i < 100 {
        intrinsic_string_builder_append(sb, large_content);
        i = i + 1;
    }
    
    let large_result = intrinsic_string_builder_build(sb);
    large_len = intrinsic_string_len(large_result);
    println(intrinsic_string_concat("Large string length: ", int_to_string(large_len)));
    
    // Test 4: Allocation under pressure
    var success_count = 0;
    var j = 0;
    while j < 500 {
        let test_alloc = intrinsic_string_new("Pressure test");
        if test_alloc != 0 {
            success_count = success_count + 1;
        }
        j = j + 1;
    }
    
    println(intrinsic_string_concat("Allocation pressure test: ", int_to_string(success_count)));
    
    if simple_len > 0 && medium_len > 0 && large_len > 0 && success_count >= 400 {
        println("=== ALL BUFFER SAFETY TESTS PASSED ===");
        println("String allocation works");
        println("Large string handling works");
        println("Memory pressure handling works");
        println("No buffer overflows detected");
        return 0;
    } else {
        println("=== BUFFER SAFETY TESTS FAILED ===");
        return 1;
    }
}